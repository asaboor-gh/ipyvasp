<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-5.1.1, furo 2022.06.21"/>
        <title>ipyvasp.splots - ipyvasp 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=40978830699223671f4072448e654b5958f38b89" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">ipyvasp 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">ipyvasp 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  
</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for ipyvasp.splots</h1><div class="highlight"><pre>
<span></span><span class="c1"># AUTOGENERATED! DO NOT EDIT! File to edit: StaticPlots.ipynb (unless otherwise specified).</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;modify_axes&#39;</span><span class="p">,</span> <span class="s1">&#39;get_axes&#39;</span><span class="p">,</span> <span class="s1">&#39;append_axes&#39;</span><span class="p">,</span> <span class="s1">&#39;join_axes&#39;</span><span class="p">,</span> <span class="s1">&#39;break_spines&#39;</span><span class="p">,</span> <span class="s1">&#39;add_text&#39;</span><span class="p">,</span> <span class="s1">&#39;splot_bands&#39;</span><span class="p">,</span>
           <span class="s1">&#39;add_legend&#39;</span><span class="p">,</span> <span class="s1">&#39;add_colorbar&#39;</span><span class="p">,</span> <span class="s1">&#39;color_wheel&#39;</span><span class="p">,</span> <span class="s1">&#39;color_cube&#39;</span><span class="p">,</span> <span class="s1">&#39;splot_rgb_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;splot_color_lines&#39;</span><span class="p">,</span>
           <span class="s1">&#39;splot_dos_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;plt2html&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;savefig&#39;</span><span class="p">,</span> <span class="s1">&#39;plt2text&#39;</span><span class="p">,</span> <span class="s1">&#39;plot_potential&#39;</span><span class="p">]</span>

<span class="c1"># Cell</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">PIL</span> <span class="c1">#For text image.</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span> <span class="k">as</span> <span class="n">LSC</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">LineCollection</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>


<span class="c1"># Inside packages import to work both with package and jupyter notebook.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ipyvasp</span> <span class="kn">import</span> <span class="n">parser</span> <span class="k">as</span> <span class="n">vp</span>
    <span class="kn">from</span> <span class="nn">ipyvasp</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">gu</span>
    <span class="kn">from</span> <span class="nn">ipyvasp</span> <span class="kn">import</span> <span class="n">serializer</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ipyvasp.parser</span> <span class="k">as</span> <span class="nn">vp</span>
    <span class="kn">import</span> <span class="nn">ipyvasp.utils</span> <span class="k">as</span> <span class="nn">gu</span>
    <span class="kn">import</span> <span class="nn">ipyvasp.serializer</span> <span class="k">as</span> <span class="nn">serializer</span>

<span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">set_matplotlib_formats</span> <span class="c1">#HTML for plt2html</span>

<span class="c1"># print SVG in ipython</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">if</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;ZMQInteractiveShell&#39;</span> <span class="ow">or</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;Shell&#39;</span><span class="p">:</span> <span class="c1"># Shell for colab.</span>
        <span class="n">set_matplotlib_formats</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span> <span class="c1"># Not in terminal</span>

<span class="c1"># Gloabal settings matplotlib</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1">#set the value globally</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;STIXGeneral&quot;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;serif&quot;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fontset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;stix&quot;</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">xticks</span><span class="o">=</span><span class="p">[],</span><span class="n">xt_labels</span><span class="o">=</span><span class="p">[],</span><span class="n">xlim</span><span class="o">=</span><span class="p">[],</span>\
            <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span><span class="n">yt_labels</span><span class="o">=</span><span class="p">[],</span><span class="n">ylim</span><span class="o">=</span><span class="p">[],</span><span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
            <span class="n">vlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">zeroline</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns None, applies given settings on axes. Prefered to use before other plotting.</span>
<span class="sd">    Args:</span>
<span class="sd">        - ax  : Matplotlib axes object.</span>
<span class="sd">        - (x,y)ticks : List of positions on (x,y axes).</span>
<span class="sd">        - (xt,yt)_labels : List of labels on (x,y) ticks points.</span>
<span class="sd">        - (x,y)lim : [min, max] of (x,y) axes.</span>
<span class="sd">        - (x,y)label : axes labels.</span>
<span class="sd">        - vlines : If true, drawn when `ylim` is not empty.</span>
<span class="sd">        - zeroline : If True, drawn when `xlim` is not empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Matplotlib axes (ax) is not given.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xticks</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xt_labels</span> <span class="k">if</span> <span class="n">xt_labels</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">xticks</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">yticks</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yt_labels</span> <span class="k">if</span> <span class="n">yt_labels</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">yticks</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">xlim</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">zeroline</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">xlim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">xlim</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylim</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vlines</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xlabel</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylabel</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">grid_alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">get_axes</span><span class="p">(</span><span class="n">figsize</span>  <span class="o">=</span> <span class="p">(</span><span class="mf">3.4</span><span class="p">,</span><span class="mf">2.6</span><span class="p">),</span>
            <span class="n">nrows</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">ncols</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">widths</span>    <span class="o">=</span> <span class="p">[],</span>
            <span class="n">heights</span>   <span class="o">=</span> <span class="p">[],</span>
            <span class="n">axes_off</span>  <span class="o">=</span> <span class="p">[],</span>
            <span class="n">axes_3d</span>   <span class="o">=</span> <span class="p">[],</span>
            <span class="n">sharex</span>    <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">sharey</span>    <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">azim</span>      <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>
            <span class="n">elev</span>      <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
            <span class="n">ortho3d</span>   <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">subplots_adjust_kwargs</span>
            <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns flatten axes of initialized figure, based on plt.subplots(). If you want to access parent figure, use ax.get_figure() or current figure as plt.gcf().</span>
<span class="sd">    Args:</span>
<span class="sd">        - figsize   : Tuple (width, height). Default is (3.4,2.6).</span>
<span class="sd">        - nrows     : Default 1.</span>
<span class="sd">        - ncols     : Default 1.</span>
<span class="sd">        - widths    : List with len(widths)==nrows, to set width ratios of subplots.</span>
<span class="sd">        - heights   : List with len(heights)==ncols, to set height ratios of subplots.</span>
<span class="sd">        - share(x,y): Share axes between plots, this removes shared ticks automatically.</span>
<span class="sd">        - axes_off  : Turn off axes visibility, If `nrows = ncols = 1, set True/False`, If anyone of `nrows or ncols &gt; 1`, provide list of axes indices to turn off. If both `nrows and ncols &gt; 1`, provide list of tuples (x_index,y_index) of axes.</span>
<span class="sd">        - axes_3d   : Change axes to 3D. If `nrows = ncols = 1, set True/False`, If anyone of `nrows or ncols &gt; 1`, provide list of axes indices to turn off. If both `nrows and ncols &gt; 1`, provide list of tuples (x_index,y_index) of axes.</span>
<span class="sd">        - azim,elev   : Matplotlib&#39;s 3D angles, defualt are 45,15.</span>
<span class="sd">        - ortho3d     : Only works for 3D axes. If True, x,y,z are orthogonal, otherwise perspective.</span>
<span class="sd">        - **subplots_adjust_kwargs : These are same as `plt.subplots_adjust()`&#39;s arguements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># SVG and rcParams are must in get_axes to bring to other files, not just here.</span>
    <span class="c1"># print SVG in ipython</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;ZMQInteractiveShell&#39;</span> <span class="ow">or</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;Shell&#39;</span><span class="p">:</span> <span class="c1"># Shell for colab.</span>
            <span class="n">set_matplotlib_formats</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span> <span class="c1"># Not in terminal</span>

    <span class="c1"># Gloabal settings matplotlib, inside figure as well</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1">#set the value globally</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;STIXGeneral&quot;</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;serif&quot;</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fontset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;stix&quot;</span>

    <span class="k">if</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">2.38</span><span class="p">:</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">gs_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">({})</span> <span class="c1"># Define Empty Dictionary.</span>
    <span class="k">if</span> <span class="n">widths</span><span class="o">!=</span><span class="p">[]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">widths</span><span class="p">)</span><span class="o">==</span><span class="n">ncols</span><span class="p">:</span>
        <span class="n">gs_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="o">**</span><span class="n">gs_kw</span><span class="p">,</span><span class="s1">&#39;width_ratios&#39;</span><span class="p">:</span><span class="n">widths</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">heights</span><span class="o">!=</span><span class="p">[]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">heights</span><span class="p">)</span><span class="o">==</span><span class="n">nrows</span><span class="p">:</span>
        <span class="n">gs_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="o">**</span><span class="n">gs_kw</span><span class="p">,</span><span class="s1">&#39;height_ratios&#39;</span><span class="p">:</span><span class="n">heights</span><span class="p">})</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gs_kw</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">)</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;proj_type&#39;</span><span class="p">:</span><span class="s1">&#39;ortho&#39;</span><span class="p">}</span> <span class="k">if</span> <span class="n">ortho3d</span> <span class="k">else</span> <span class="p">{}</span> <span class="c1"># For 3D only</span>
    <span class="k">if</span> <span class="n">nrows</span><span class="o">*</span><span class="n">ncols</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axes_off</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">axes_3d</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="n">axs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span><span class="n">azim</span><span class="o">=</span><span class="n">azim</span><span class="p">,</span><span class="n">elev</span><span class="o">=</span><span class="n">elev</span><span class="p">,</span><span class="o">**</span><span class="n">proj</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">add_legend</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">add_legend</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">axs</span><span class="p">)))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span> <span class="k">for</span> <span class="n">inds</span> <span class="ow">in</span> <span class="n">axes_off</span> <span class="k">if</span> <span class="n">axes_off</span><span class="o">!=</span><span class="p">[]]</span>
        <span class="k">if</span> <span class="n">axes_3d</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">for</span> <span class="n">inds</span> <span class="ow">in</span> <span class="n">axes_3d</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span><span class="n">azim</span><span class="o">=</span><span class="n">azim</span><span class="p">,</span><span class="n">elev</span><span class="o">=</span><span class="n">elev</span><span class="p">,</span><span class="o">**</span><span class="n">proj</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axs</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="n">add_text</span><span class="p">,</span><span class="n">add_legend</span><span class="p">,</span><span class="n">add_colorbar</span><span class="p">,</span><span class="n">color_wheel</span><span class="p">,</span><span class="n">color_cube</span><span class="p">,</span> <span class="n">break_spines</span><span class="p">,</span><span class="n">modify_axes</span><span class="p">,</span><span class="n">append_axes</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ax</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;3d&#39;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">ax</span><span class="p">)))</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="o">**</span><span class="n">subplots_adjust_kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">axs</span>

<div class="viewcode-block" id="append_axes"><a class="viewcode-back" href="../../index.html#ipyvasp.append_axes">[docs]</a><span class="k">def</span> <span class="nf">append_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Append an axes to the given `ax` at given `position` |top|right|left|bottom|. Useful for adding custom colorbar.</span>
<span class="sd">    kwargs are passed to `mpl_toolkits.axes_grid1.make_axes_locatable.append_axes`.</span>
<span class="sd">    Returns appended axes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">extra_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">add_to_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sharex</span><span class="p">:</span>
        <span class="n">extra_args</span><span class="p">[</span><span class="s1">&#39;sharex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span>
    <span class="k">if</span> <span class="n">sharey</span><span class="p">:</span>
        <span class="n">extra_args</span><span class="p">[</span><span class="s1">&#39;sharey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">added_ax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">added_ax</span><span class="p">)</span> <span class="c1"># tweaks of styles</span>
    <span class="k">return</span> <span class="n">added_ax</span></div>

<div class="viewcode-block" id="join_axes"><a class="viewcode-back" href="../../index.html#ipyvasp.join_axes">[docs]</a><span class="k">def</span> <span class="nf">join_axes</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Join two axes together. Useful for adding custom colorbar on a long left axes of whole figure.</span>
<span class="sd">    Apply tight_layout() before calling this function.</span>
<span class="sd">    kwargs are passed to `fig.add_axes`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span><span class="n">p2</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span><span class="n">p2</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span><span class="n">p2</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">y1</span><span class="p">,</span><span class="n">p2</span><span class="o">.</span><span class="n">y1</span><span class="p">)</span>
    <span class="n">new_bbox</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="n">y1</span><span class="o">-</span><span class="n">y0</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    <span class="n">new_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">new_bbox</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">modify_axes</span><span class="p">(</span><span class="n">new_ax</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="n">add_text</span><span class="p">,</span><span class="n">add_legend</span><span class="p">,</span><span class="n">add_colorbar</span><span class="p">,</span><span class="n">color_wheel</span><span class="p">,</span><span class="n">break_spines</span><span class="p">,</span><span class="n">modify_axes</span><span class="p">,</span><span class="n">append_axes</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">new_ax</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;3d&#39;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">new_ax</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">new_ax</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">new_ax</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">new_ax</span></div>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">break_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">spines</span><span class="p">,</span><span class="n">symbol</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2571</span><span class="s1">&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simulates broken axes using subplots. Need to fix heights according to given data for real aspect. Also plot the same data on each axes and set axes limits.</span>
<span class="sd">    Args:</span>
<span class="sd">        - ax : Axes who&#39;s spine(s) to edit.</span>
<span class="sd">        - spines: str,list, str/list of any of [&#39;top&#39;,&#39;bottom&#39;,&#39;left&#39;,&#39;right&#39;].</span>
<span class="sd">        - symbol: Defult is u&#39;\u2571&#39;. Its at 60 degrees. so you can apply rotation to make it any angle.</span>
<span class="sd">    kwargs are passed to plt.text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">_spines</span> <span class="o">=</span> <span class="p">[</span><span class="n">spines</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spines</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">spines</span>
    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">_spines</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">sp</span><span class="p">:</span><span class="kc">False</span> <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">_spines</span><span class="p">})</span>
    <span class="k">if</span> <span class="s1">&#39;top&#39;</span> <span class="ow">in</span> <span class="n">spines</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;bottom&#39;</span> <span class="ow">in</span> <span class="n">spines</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;left&#39;</span> <span class="ow">in</span> <span class="n">spines</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;right&#39;</span> <span class="ow">in</span> <span class="n">spines</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">_plot_bands</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">kpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Fermi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">interp_nk</span> <span class="o">=</span> <span class="p">{},</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns axes object and plot on which all matplotlib allowed actions could be performed.</span>
<span class="sd">    Args:</span>
<span class="sd">        - ax         : Matplotlib axes object, if not given, one is created.</span>
<span class="sd">        - kpath      : 1D array from `get_kpts`().kpath or `export_vasprun`().kpath.</span>
<span class="sd">        - bands      : Dictionary Object from `get_evals` or `export_vasprun`().bands.</span>
<span class="sd">        - showlegend : Boolean, default is False, if true, gives legend for spin-polarized calculations.</span>
<span class="sd">        - Fermi    : If not given, automatically picked from bands object.</span>
<span class="sd">        - interp_nk  : Dictionary with keys &#39;n&#39; and &#39;k&#39; for interpolation.</span>

<span class="sd">    Additional kwargs are passed to matplotlib.lines.Lin2D. For passing a keyword to spindown channel, append an underscore, e.g &#39;lw&#39; goes to SpinUp and &#39;lw_&#39; goes to SpinDown.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - ax : matplotlib axes object with plotted bands.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Fixing ax argument</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">get_axes</span><span class="p">()</span> <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ax</span>
    <span class="c1"># Fixing kpath argument</span>
    <span class="k">if</span> <span class="n">kpath</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;kpath is not provided. Use get_kpath() or export_vasprun().kpath to generate it.&quot;</span><span class="p">)</span>
    <span class="c1"># Fixing bands arguement</span>
    <span class="k">if</span> <span class="n">bands</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bands object is not provided. Use get_evals() or export_vasprun().bands to generate it.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Fermi</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
       <span class="n">Fermi</span> <span class="o">=</span> <span class="n">bands</span><span class="o">.</span><span class="n">Fermi</span>

    <span class="c1"># Plotting</span>
    <span class="n">kws_u</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)}</span>
    <span class="n">kws_d</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)}</span>
    <span class="n">kws_u</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;SpinUp&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kws_u</span><span class="p">}</span> <span class="c1">#Update label if not given</span>
    <span class="n">kws_d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;SpinDown&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kws_d</span><span class="p">}</span>
    <span class="c1"># Set color and linewidth if not provided</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_prop_cycle</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="p">[((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)),],</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,])</span> <span class="c1">#For spinup and simple if not given</span>

    <span class="k">if</span> <span class="n">bands</span><span class="o">.</span><span class="n">ISPIN</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can not plot an empty eigenvalues object.</span><span class="se">\n</span><span class="s2">&quot;</span>
                            <span class="s2">&quot;Try with large energy range.&quot;</span><span class="p">)</span>

        <span class="n">en</span> <span class="o">=</span> <span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">-</span><span class="n">Fermi</span>
        <span class="k">if</span> <span class="n">interp_nk</span><span class="p">:</span>
            <span class="n">kpath</span><span class="p">,</span><span class="n">en</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">en</span><span class="p">,</span><span class="o">**</span><span class="n">interp_nk</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">en</span><span class="p">,</span><span class="o">**</span><span class="n">kws_u</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="k">if</span> <span class="n">bands</span><span class="o">.</span><span class="n">ISPIN</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinUp</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can not plot an empty eigenvalues object.</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="s2">&quot;Try with large energy range.&quot;</span><span class="p">)</span>
        <span class="n">enUp</span> <span class="o">=</span> <span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinUp</span><span class="o">-</span><span class="n">Fermi</span>
        <span class="n">enDown</span> <span class="o">=</span> <span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinDown</span><span class="o">-</span><span class="n">Fermi</span>
        <span class="k">if</span> <span class="n">interp_nk</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">enUp</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">enUp</span><span class="p">,</span><span class="o">**</span><span class="n">interp_nk</span><span class="p">)</span>
            <span class="c1">#Do not reassign kpath in first line, it will throw error in next</span>
            <span class="n">kpath</span><span class="p">,</span><span class="n">enDown</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">enDown</span><span class="p">,</span><span class="o">**</span><span class="n">interp_nk</span><span class="p">)</span>

        <span class="n">lines_u</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">enUp</span><span class="p">,</span><span class="o">**</span><span class="n">kws_u</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_u</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_prop_cycle</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,],</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.2</span><span class="p">,],</span><span class="n">linestyle</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;dashed&#39;</span><span class="p">,])</span> <span class="c1">#For spindown if not given</span>
        <span class="n">lines_d</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">enDown</span><span class="p">,</span><span class="o">**</span><span class="n">kws_d</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_d</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>

        <span class="c1"># Legend only for spin polarized</span>
        <span class="k">if</span> <span class="n">showlegend</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="add_text"><a class="viewcode-back" href="../../index.html#ipyvasp.add_text">[docs]</a><span class="k">def</span> <span class="nf">add_text</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">xs</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">ys</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">txts</span><span class="o">=</span><span class="s1">&#39;[List]&#39;</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Adds text entries on axes, given single string or list.</span>
<span class="sd">    Args:</span>
<span class="sd">        - xs    : List of x coordinates relative to axes or single coordinate.</span>
<span class="sd">        - ys    : List of y coordinates relative to axes or single coordinate.</span>
<span class="sd">        - txts  : List of strings or one string.</span>
<span class="sd">        - colors: List of x colors of txts or one color.</span>
<span class="sd">        - transform: Dafault is True and positions are relative to axes, If False, positions are in data coordinates.</span>

<span class="sd">    kwargs are passed to plt.text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Matplotlib axes (ax) is not given.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bbox&#39;</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">))</span>
        <span class="n">ha</span><span class="p">,</span> <span class="n">va</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ha&#39;</span><span class="p">,</span><span class="s1">&#39;center&#39;</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;va&#39;</span><span class="p">,</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="n">args_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">args_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">})</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">txts</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">txts</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="o">**</span><span class="n">args_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">txts</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,(</span><span class="n">i</span><span class="p">,</span><span class="n">txt</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">txts</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">txt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">args_dict</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">txt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span><span class="o">**</span><span class="n">args_dict</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">splot_bands</span><span class="p">(</span><span class="n">path_evr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">skipk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">kseg_inds</span><span class="o">=</span><span class="p">[],</span><span class="n">elim</span><span class="o">=</span><span class="p">[],</span><span class="n">ktick_inds</span><span class="o">=</span><span class="p">[],</span><span class="n">ktick_vals</span><span class="o">=</span><span class="p">[],</span><span class="n">Fermi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">xytxt</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.9</span><span class="p">],</span><span class="n">ctxt</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">interp_nk</span> <span class="o">=</span> <span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns axes object and plot on which all matplotlib allowed actions could be performed.</span>
<span class="sd">    Args:</span>
<span class="sd">        - path_evr   : path/to/vasprun.xml or output of `export_vasprun`. Auto picks in CWD.</span>
<span class="sd">        - ax         : Matplotlib axes object, if not given, one is created.</span>
<span class="sd">        - skipk      : Number of kpoints to skip, default will be from IBZKPT.</span>
<span class="sd">        - kseg_inds : Points where kpath is broken.</span>
<span class="sd">        - elim       : [min,max] of energy range.</span>
<span class="sd">        - Fermi    : If not given, automatically picked from `export_vasprun`.</span>
<span class="sd">        - ktick_inds : High symmetry kpoints indices.abs</span>
<span class="sd">        - ktick_vals  : High Symmetry kpoints labels.</span>
<span class="sd">        - txt,xytxt and ctxt are extra arguments for text on figure.</span>
<span class="sd">        - interp_nk   : Dictionary with keys &#39;n&#39; and &#39;k&#39; for interpolation.</span>

<span class="sd">    Additional kwargs are passed to matplotlib.lines.Lin2D. For passing a keyword to spindown channel, append an underscore, e.g &#39;lw&#39; goes to SpinUp and &#39;lw_&#39; goes to SpinDown.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - ax : matplotlib axes object with plotted bands.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vr</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">_validate_evr</span><span class="p">(</span><span class="n">path_evr</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span><span class="n">skipk</span><span class="o">=</span><span class="n">skipk</span><span class="p">,</span><span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">)</span>

    <span class="c1"># Main working here.</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">join_ksegments</span><span class="p">(</span><span class="n">vr</span><span class="o">.</span><span class="n">kpath</span><span class="p">,</span><span class="n">kseg_inds</span><span class="o">=</span><span class="n">kseg_inds</span><span class="p">)</span>
    <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ktick_inds</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">K</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">K</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">elim</span><span class="p">:</span>
        <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">elim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">elim</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ylim</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">get_axes</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">Fermi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Fermi</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">fermi</span>

    <span class="n">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span><span class="n">xt_labels</span><span class="o">=</span><span class="n">ktick_vals</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">vlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_plot_bands</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">bands</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">interp_nk</span> <span class="o">=</span> <span class="n">interp_nk</span><span class="p">,</span> <span class="n">Fermi</span><span class="o">=</span><span class="n">Fermi</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">txt</span> <span class="k">if</span> <span class="n">txt</span> <span class="k">else</span> <span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">SYSTEM</span>
    <span class="n">add_text</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="o">*</span><span class="n">xytxt</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">ctxt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="add_legend"><a class="viewcode-back" href="../../index.html#ipyvasp.add_legend">[docs]</a><span class="k">def</span> <span class="nf">add_legend</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="p">[],</span><span class="n">labels</span><span class="o">=</span><span class="p">[],</span><span class="n">styles</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span>\
                <span class="n">widths</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Adds custom legeneds on a given axes,returns None.</span>
<span class="sd">    Args:</span>
<span class="sd">        - ax       : Matplotlib axes.</span>
<span class="sd">        - colors   : List of colors.</span>
<span class="sd">        - labels   : List of labels.</span>
<span class="sd">        - styles   : str or list of line styles.</span>
<span class="sd">        - widths   : str or list of line widths.</span>

<span class="sd">    kwargs are passed to plt.legend. Given arguments like anchor,ncol etc are preferred.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Matplotlib axes (ax) is not given.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">widths</span><span class="p">)</span><span class="o">==</span><span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">widths</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">color</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">widths</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">styles</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">style</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">styles</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">widths</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">style</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">width</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">widths</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">styles</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">style</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">widths</span><span class="p">,</span><span class="n">styles</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">style</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>

<span class="c1"># Cell</span>

<span class="c1">#export</span>
<div class="viewcode-block" id="add_colorbar"><a class="viewcode-back" href="../../index.html#ipyvasp.add_colorbar">[docs]</a><span class="k">def</span> <span class="nf">add_colorbar</span><span class="p">(</span>
    <span class="n">ax</span><span class="p">,</span>
    <span class="n">cmap_or_clist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">N</span>             <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
    <span class="n">ticks</span>         <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ticklabels</span>    <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vmin</span>          <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span>          <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cax</span>           <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tickloc</span>       <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span>
    <span class="n">vertical</span>      <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">digits</span>        <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">fontsize</span>      <span class="o">=</span> <span class="mi">8</span>
    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Plots colorbar on a given axes. This axes should be only for colorbar. Returns None or throws ValueError for given colors.</span>
<span class="sd">    Args:</span>
<span class="sd">        - ax         : Matplotlib axes for which colorbar will be added.</span>
<span class="sd">        - cmap_or_clist: List/array of colors in or colormap&#39;s name. If None (default), matplotlib&#39;s default colormap is plotted.</span>
<span class="sd">        - N          : int, number of color points Default 256.</span>
<span class="sd">        - ticks      : List of tick values to show on colorbar. To turn off, give [].</span>
<span class="sd">        - ticklabels : List of labels for ticks.</span>
<span class="sd">        - vmin,vmax  : Minimum and maximum values. Only work if ticks are given.</span>
<span class="sd">        - cax        : Matplotlib axes for colorbar. If not given, one is created.</span>
<span class="sd">        - tickloc    : Default &#39;right&#39;. Any of [&#39;right&#39;,&#39;left&#39;,&#39;top&#39;,&#39;bottom&#39;].</span>
<span class="sd">        - digits     : Number of digits to show in tick if ticklabels are not given.</span>
<span class="sd">        - vertical   : Boolean, default is Fasle.</span>
<span class="sd">        - fontsize   : Default 8. Adjustable according to plot space.</span>

<span class="sd">    - **Returns**</span>
<span class="sd">        - cax : Matplotlib axes for colorbar, you can customize further.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">position</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span> <span class="k">if</span> <span class="n">vertical</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="s1">&#39;top&#39;</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">append_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">position</span><span class="o">=</span> <span class="n">position</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cmap_or_clist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">_hsv_</span> <span class="o">=</span> <span class="n">LSC</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;_hsv_&#39;</span><span class="p">,</span><span class="n">colors</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap_or_clist</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_hsv_</span> <span class="o">=</span> <span class="n">LSC</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;_hsv_&#39;</span><span class="p">,</span><span class="n">cmap_or_clist</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Falling back to default color map!&quot;</span><span class="p">)</span>
            <span class="n">_hsv_</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># fallback</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap_or_clist</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="n">_hsv_</span> <span class="o">=</span> <span class="n">cmap_or_clist</span> <span class="c1">#colormap name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_hsv_</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># default fallback</span>

    <span class="k">if</span> <span class="n">ticks</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="n">ticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># should be before labels</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ticklabels</span> <span class="o">=</span> <span class="n">ticks</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ticks</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
            <span class="n">_vmin</span> <span class="o">=</span> <span class="n">vmin</span> <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
            <span class="n">_vmax</span> <span class="o">=</span> <span class="n">vmax</span> <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_vmin</span> <span class="o">&gt;</span> <span class="n">_vmax</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vmin &gt; vmax is not valid!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ticklabels</span> <span class="o">=</span> <span class="n">ticks</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="c1"># Renormalize ticks after assigning ticklabels</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="p">(</span><span class="n">ticks</span> <span class="o">-</span> <span class="n">_vmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">_vmax</span> <span class="o">-</span> <span class="n">_vmin</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ticklabels</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">c_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">))</span> <span class="c1"># make 2D array</span>

    <span class="n">ticks_param</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">grid_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">grid_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ticks_param</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">tickloc</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span> <span class="c1"># Only show on given side</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">ticks_param</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vertical</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">c_vals</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">_hsv_</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span> <span class="c1"># to show ticks on top by default</span>
        <span class="k">if</span> <span class="n">tickloc</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
            <span class="n">cax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_bottom</span><span class="p">()</span> <span class="c1"># top is by default</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ticklabels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#enforce limit</span>

    <span class="k">if</span> <span class="n">vertical</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">c_vals</span> <span class="o">=</span> <span class="n">c_vals</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">c_vals</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">_hsv_</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span> <span class="c1"># Show right by default</span>
        <span class="k">if</span> <span class="n">tickloc</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
            <span class="n">cax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_left</span><span class="p">()</span> <span class="c1"># right is by default</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ticklabels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># enforce limit</span>

    <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">cax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
        <span class="n">tick</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">cax</span><span class="o">.</span><span class="n">get_children</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">Spine</span><span class="p">):</span>
            <span class="n">child</span><span class="o">.</span><span class="n">set_color</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">cax</span> <span class="c1"># Return colorbar axes to perform further customization</span></div>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="color_wheel"><a class="viewcode-back" href="../../index.html#ipyvasp.color_wheel">[docs]</a><span class="k">def</span> <span class="nf">color_wheel</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.12</span><span class="p">,</span>
                <span class="n">rlim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
                <span class="n">colormap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="o">/</span><span class="mi">6</span><span class="p">],</span>
                <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns cax i.e. color wheel axes.</span>
<span class="sd">    Args:</span>
<span class="sd">        - ax        : Axes on which color wheel will be drawn. Auto created if not given.</span>
<span class="sd">        - xy        : (x,y) of center of wheel.</span>
<span class="sd">        - scale     : Scale of the cax internally generated by color wheel.</span>
<span class="sd">        - rlim      : Values in [0,1] interval, to make donut like shape.</span>
<span class="sd">        - N         : Number of segments in color wheel.</span>
<span class="sd">        - colormap  : Matplotlib&#39;s color map name. fallbacks to `hsv`.</span>
<span class="sd">        - ticks     : Ticks in fractions in interval [0,1].</span>
<span class="sd">        - labels    : Ticks labels.</span>
<span class="sd">        - showlegend: True or False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">get_axes</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">colormap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">colormap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;hsv&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">height</span><span class="o">/</span><span class="n">pos</span><span class="o">.</span><span class="n">width</span>
    <span class="n">cpos</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span><span class="o">.</span><span class="n">x0</span><span class="o">+</span><span class="n">pos</span><span class="o">.</span><span class="n">width</span><span class="o">*</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">scale</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">pos</span><span class="o">.</span><span class="n">y0</span><span class="o">+</span><span class="n">pos</span><span class="o">.</span><span class="n">height</span><span class="o">*</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">scale</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">scale</span><span class="p">,</span><span class="n">scale</span><span class="p">]</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">cpos</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">rlim</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">rg</span><span class="p">,</span><span class="n">tg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">tg</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;face&#39;</span><span class="p">,</span><span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">)</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">##########</span>
    <span class="k">if</span> <span class="n">showlegend</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)(</span><span class="n">ticks</span><span class="p">)</span> <span class="c1"># Get colors values.</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
        <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="c1">#hack to write labels correctly on a single point.</span>
        <span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span> <span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,[</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="s1">&#39;top&#39;</span><span class="p">],</span><span class="n">colors</span><span class="p">):</span>
            <span class="n">cax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">cax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">t</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">])</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cax</span></div>

<span class="c1"># Cell</span>
<span class="kn">import</span> <span class="nn">matplotlib.patheffects</span> <span class="k">as</span> <span class="nn">path_effects</span>
<span class="k">def</span> <span class="nf">_get_pros_data</span><span class="p">(</span>
    <span class="n">kpath</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">evals_set</span>   <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pros_set</span>    <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">elements</span>    <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
    <span class="n">orbs</span>        <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
    <span class="n">interp_nk</span>   <span class="o">=</span> <span class="p">{},</span>
    <span class="n">scale_data</span>  <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns selected elements/orbitals data.</span>
<span class="sd">    Args:</span>
<span class="sd">        - kapath   : `export_vasprun`().kpath or `get_kpts`().kpath.</span>
<span class="sd">        - evals_set: `export_vasprun`().bands.evals or `get_evals`().evals. If calculations are spin-polarized, it will be `...evals.SpinUp/SpinDown` for both.</span>
<span class="sd">        - pros_set : `export_vasprun().pro_bands.pros` or `get_bands_pro_set`().pros. If calculations are spin-polarized, it will be `...pros.SpinUp/SpinDown` for both.</span>
<span class="sd">        - elements : Lists of list of ions to project on, could be `range(start,stop,step)` as well, remember that `stop` is not included in python. so `range(0,2)` will generate 0 and 1 indices.</span>
<span class="sd">        - orbs     : List of lists of orbitals indices.</span>
<span class="sd">        - scale_data : If True, normalizes projection data to 1.</span>
<span class="sd">        - interp_nk   : Dictionary with keys &#39;n&#39; and &#39;k&#39; for interpolation.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - A dictionary with keys &#39;kpath&#39;, &#39;evals&#39;, &#39;colors&#39; that can be unpacked in next function&#39;s arguemnet.</span>
<span class="sd">            - &#39;kpath&#39; : Given or interpolated kpath of shape (NKPTS,).</span>
<span class="sd">            - &#39;evals&#39; : Given or interpolated evals_set of shape (NKPTS,NBANDS).</span>
<span class="sd">            - &#39;pros&#39;: An array of shape (NKPTS,NBANDS,n) where n is length of input elements list. If scale_data = True, normalizes this array to 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pros_set</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can not process an empty eigenvalues/projection object.</span><span class="se">\n</span><span class="s2">&quot;</span>
                         <span class="s2">&quot;Try with large `elim` in parent function.&quot;</span><span class="p">)</span>
    <span class="c1"># Empty orbitals/elements are still allowed on purpose for rgb_lines.</span>
    <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">orb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orb</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Items in elements and orbs should be list, tuple or range, not int.&quot;</span><span class="p">)</span>

    <span class="n">arrays_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">elem</span><span class="p">,</span><span class="n">orb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">):</span>
        <span class="n">pros</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">pros_set</span><span class="p">,</span><span class="n">elem</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">_pros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">pros</span><span class="p">,</span><span class="n">orb</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">arrays_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_pros</span><span class="p">)</span>
    <span class="n">_shape</span>  <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrays_list</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">_pros</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">arrays_list</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">_shape</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">scale_data</span><span class="p">:</span> <span class="c1"># Normalize overall data</span>
        <span class="n">c_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_colors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c_max</span> <span class="o">&gt;</span> <span class="mf">0.0000001</span><span class="p">:</span> <span class="c1"># Avoid division error</span>
            <span class="n">_colors</span> <span class="o">=</span> <span class="n">_colors</span><span class="o">/</span><span class="n">c_max</span>

    <span class="k">if</span> <span class="n">interp_nk</span><span class="p">:</span>
        <span class="n">min_d</span><span class="p">,</span> <span class="n">max_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_colors</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_colors</span><span class="p">)</span> <span class="c1"># For cliping</span>
        <span class="kn">from</span> <span class="nn">ipyvasp</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">gu</span>
        <span class="n">knew</span><span class="p">,</span> <span class="n">evals</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">evals_set</span><span class="p">,</span><span class="o">**</span><span class="n">interp_nk</span><span class="p">)</span>
        <span class="n">_colors</span>     <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">_colors</span><span class="p">,</span><span class="o">**</span><span class="n">interp_nk</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_d</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="n">max_d</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;kpath&#39;</span><span class="p">:</span><span class="n">knew</span><span class="p">,</span><span class="s1">&#39;evals&#39;</span><span class="p">:</span> <span class="n">evals</span><span class="p">,</span><span class="s1">&#39;pros&#39;</span><span class="p">:</span> <span class="n">_colors</span><span class="p">}</span>
    <span class="c1"># Return if no interpolation</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;kpath&#39;</span><span class="p">:</span><span class="n">kpath</span><span class="p">,</span><span class="s1">&#39;evals&#39;</span><span class="p">:</span> <span class="n">evals_set</span><span class="p">,</span><span class="s1">&#39;pros&#39;</span><span class="p">:</span> <span class="n">_colors</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">_make_line_collection</span><span class="p">(</span><span class="n">max_width</span>   <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">colors_list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">rgb</span>         <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">shadow</span>      <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">pros_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns a tuple of line collections. If rgb = True (at len(orbs) = 3 in `_get_pros_data`), returns a tuple of two entries, multicolored line collection and RGB maximum values, otherwise return tuple of single colored multiple lines.</span>
<span class="sd">    - **Parametrs**</span>
<span class="sd">        - **pros_data: Output dictionary from `_get_pros_data` containing kpath, evals and colors arrays.</span>
<span class="sd">        - max_width  : Default is None and max linwidth = 2.5. Max inewidth is scaled to max_width if an int of float is given.</span>
<span class="sd">        - colors_list: List of colors for multiple lines, length equal to 3rd axis length of colors.</span>
<span class="sd">        - rgb        : Default is False. If True and np.shape(colors)[-1] == 3, RGB line collection is returned in a tuple of length 1. Tuple is just to support iteration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pros_data</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No pros_data given.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kpath</span>  <span class="o">=</span> <span class="n">pros_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kpath&#39;</span><span class="p">)</span>
        <span class="n">evals</span>  <span class="o">=</span> <span class="n">pros_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;evals&#39;</span><span class="p">)</span>
        <span class="n">pros</span>   <span class="o">=</span> <span class="n">pros_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pros&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">kpath</span><span class="p">,</span> <span class="n">evals</span><span class="p">,</span> <span class="n">pros</span><span class="p">],[</span><span class="s1">&#39;kpath&#39;</span><span class="p">,</span> <span class="s1">&#39;evals&#39;</span><span class="p">,</span> <span class="s1">&#39;pros&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing </span><span class="si">{!r}</span><span class="s2"> from output of `_get_pros_data()`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

    <span class="c1"># Average pros on two consecutive KPOINTS to get that patch color.</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">pros</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:,:]</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">pros</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># Near kpoints avearge</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">colors</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="c1"># Must before lws</span>

    <span class="c1"># Default linewidth = 2.5 unless specified otherwise</span>
    <span class="k">if</span> <span class="n">rgb</span><span class="p">:</span> <span class="c1"># Single channel line widths</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lws</span> <span class="o">=</span> <span class="n">pros_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lws&#39;</span><span class="p">)</span> <span class="c1">#Get from splot_rgb_lines, so lws represent actual data</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">lws</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># If not called from splot_rgb_lines</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># For separate lines</span>
        <span class="n">lws</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">2.5</span><span class="o">*</span><span class="n">colors</span><span class="o">.</span><span class="n">T</span> <span class="c1"># .T to access in for loop.</span>

    <span class="k">if</span> <span class="n">max_width</span><span class="p">:</span>
        <span class="c1"># here division does not fail as min(lws)==0.1</span>
        <span class="n">lws</span> <span class="o">=</span> <span class="n">max_width</span><span class="o">*</span><span class="n">lws</span><span class="o">/</span><span class="p">(</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lws</span><span class="p">))</span> <span class="c1"># Only if not None or zero.</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">colors_list</span><span class="p">):</span>
        <span class="n">lc_colors</span> <span class="o">=</span> <span class="n">colors_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
        <span class="n">lc_colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">colors</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">lc_colors</span> <span class="o">=</span> <span class="n">lc_colors</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># Skip Alpha</span>

    <span class="c1"># Reshaping data same as colors reshaped above, nut making line patches too.</span>
    <span class="n">kgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">evals</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">evals</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">narr</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">kgrid</span><span class="p">,</span><span class="n">evals</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">evals</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">marr</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">narr</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:],</span><span class="n">narr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:,:]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Make Line collection</span>
    <span class="n">path_shadow</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">shadow</span><span class="p">:</span>
        <span class="n">path_shadow</span> <span class="o">=</span> <span class="p">[</span><span class="n">path_effects</span><span class="o">.</span><span class="n">SimpleLineShadow</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.8</span><span class="p">),</span><span class="n">rho</span><span class="o">=</span><span class="mf">0.2</span><span class="p">),</span><span class="n">path_effects</span><span class="o">.</span><span class="n">Normal</span><span class="p">()]</span>
    <span class="k">if</span> <span class="n">rgb</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">colors</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LineCollection</span><span class="p">(</span><span class="n">marr</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="n">lws</span><span class="p">,</span> <span class="n">path_effects</span> <span class="o">=</span> <span class="n">path_shadow</span><span class="p">),)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">LineCollection</span><span class="p">(</span><span class="n">marr</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">_cl</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">path_effects</span> <span class="o">=</span> <span class="n">path_shadow</span><span class="p">)</span> <span class="k">for</span> <span class="n">_cl</span><span class="p">,</span><span class="n">lw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lc_colors</span><span class="p">,</span><span class="n">lws</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">lcs</span><span class="p">)</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">_validate_input</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">sys_info</span><span class="p">,</span><span class="n">rgb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Fix input elements, orbs and labels according to given sys_info. Returns (Bool, elements, orbs,labels).&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">orbs</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`elements`, `orbs` and `labels` expect same length, even if empty.&quot;</span><span class="p">)</span>

    <span class="n">elem_inds</span> <span class="o">=</span> <span class="n">sys_info</span><span class="o">.</span><span class="n">ElemIndex</span>
    <span class="n">max_ind</span>   <span class="o">=</span> <span class="n">elem_inds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="c1"># Last index is used for range in ElemIndex, not python index.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">copy</span><span class="p">()):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">elem_inds</span><span class="p">[</span><span class="n">elem</span><span class="p">],</span><span class="n">elem_inds</span><span class="p">[</span><span class="n">elem</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Given </span><span class="si">{</span><span class="n">elem</span><span class="si">}</span><span class="s2"> at position </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> of sequence =&gt; </span><span class="si">{</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ElemName</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span><span class="si">!r}</span><span class="s2">: </span><span class="si">{</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">(</span><span class="n">info</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;To just pick one ion, write it as [</span><span class="si">{</span><span class="n">elem</span><span class="si">}</span><span class="s2">].&quot;</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrap </span><span class="si">{</span><span class="n">elem</span><span class="si">}</span><span class="s2"> at position </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> of sequence in []. You have only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ElemName</span><span class="p">)</span><span class="si">}</span><span class="s2"> types of ions.&quot;</span><span class="p">)</span>

    <span class="n">_es</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">(</span><span class="o">*</span><span class="n">ee</span><span class="p">,)]</span> <span class="c1"># important if ee is int</span>
    <span class="k">if</span>  <span class="n">_es</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">_es</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_ind</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;index </span><span class="si">{}</span><span class="s2"> is out of bound for </span><span class="si">{}</span><span class="s2"> ions&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">_es</span><span class="p">),</span><span class="n">max_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Orbitals Index fixing</span>
    <span class="n">nfields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys_info</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
    <span class="n">orbs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">item</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">orbs</span><span class="p">]</span> <span class="c1">#Fix if integer given.</span>
    <span class="n">_os</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">orbs</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">]</span>
    <span class="k">if</span>  <span class="n">_os</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">_os</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">nfields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;index </span><span class="si">{}</span><span class="s2"> is out of bound for </span><span class="si">{}</span><span class="s2"> orbs&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">_os</span><span class="p">),</span><span class="n">nfields</span><span class="p">))</span>

    <span class="k">while</span> <span class="n">rgb</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="c1"># &lt; 3 as it appends to make it 3.</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="n">orbs</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rgb</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Only keeping first 3 entries in elements/orbs/labels in RGB plots.&#39;</span><span class="p">)</span>
        <span class="n">elements</span><span class="p">,</span> <span class="n">orbs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">orbs</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">labels</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

    <span class="c1"># If elements not given, get whole system in case of RGB_Lines</span>
    <span class="k">if</span> <span class="n">rgb</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_es</span><span class="p">:</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">max_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">max_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">max_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">rgb</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_os</span><span class="p">:</span>
        <span class="n">orbs</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">]]</span> <span class="k">if</span> <span class="n">nfields</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">rgb</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_es</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_os</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">sys_info</span><span class="o">.</span><span class="n">SYSTEM</span> <span class="o">+</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-s&#39;</span><span class="p">,</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span><span class="s1">&#39;-d&#39;</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span>

<span class="k">def</span> <span class="nf">_format_input</span><span class="p">(</span><span class="n">query_data</span><span class="p">,</span><span class="n">rgb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format input elements, orbs and labels according to query_data.</span>
<span class="sd">    query_data = {&#39;Ga-s&#39;:(0,[1]),&#39;Ga-p&#39;:(0,[1,2,3]),&#39;Ga-d&#39;:(0,[4,5,6,7,8])} #for Ga in GaAs, to pick Ga-1, use [0] instead of 0 at first place</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query_data</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`query_data` must be a dictionary, with keys as labels and values from picked projection indices.&quot;</span><span class="p">)</span>

    <span class="c1"># Set default values for different situations</span>
    <span class="k">if</span> <span class="n">rgb</span><span class="p">:</span>
        <span class="n">elements</span><span class="p">,</span> <span class="n">orbs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[[],[],[]],</span> <span class="p">[[],[],[]],</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elements</span><span class="p">,</span> <span class="n">orbs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span> <span class="p">[</span><span class="s1">&#39;Element0-s&#39;</span><span class="p">,]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">query_data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">!r}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> expects 2 items (elements, orbs), got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rgb</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
            <span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">orbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="n">rgb</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RGB plots can only have 3 items, skipping </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">rgb</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">orbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Selection&#39;</span><span class="p">,[</span><span class="s1">&#39;elements&#39;</span><span class="p">,</span><span class="s1">&#39;orbs&#39;</span><span class="p">,</span><span class="s1">&#39;labels&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">nt</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">orbs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

<span class="c1"># Cell</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">tri</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PolyCollection</span>

<div class="viewcode-block" id="color_cube"><a class="viewcode-back" href="../../index.html#ipyvasp.color_cube">[docs]</a><span class="k">def</span> <span class="nf">color_cube</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;brg&#39;</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
              <span class="n">N</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="s2">&quot;Color-mapped hexagon that serves as a legend for `splot_rgb_lines`&quot;</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;N must be &gt;= 3 to map colors correctly.&quot;</span><span class="p">)</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">points_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">points_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">points_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

    <span class="kn">from</span> <span class="nn">.sio</span> <span class="kn">import</span> <span class="n">to_R3</span><span class="p">,</span> <span class="n">rotation</span> <span class="c1"># Avoids circular import</span>

    <span class="n">all_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">to_R3</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span><span class="n">points_z</span><span class="p">)</span>
    <span class="n">all_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
    <span class="n">ps1</span> <span class="o">=</span> <span class="n">rotation</span><span class="p">(</span><span class="n">angle_deg</span><span class="o">=-</span><span class="mi">120</span><span class="p">,</span><span class="n">axis_vec</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ps</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">all_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ps1</span><span class="p">)</span>
    <span class="n">ps2</span> <span class="o">=</span> <span class="n">rotation</span><span class="p">(</span><span class="n">angle_deg</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span><span class="n">axis_vec</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ps</span><span class="o">*</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">all_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ps2</span><span class="p">)</span>

    <span class="n">all_points</span> <span class="o">=</span> <span class="n">rotation</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="n">axis_vec</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">all_points</span><span class="p">)</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">all_points</span><span class="p">)[:,:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">-</span> <span class="n">pts</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># center</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">*</span><span class="n">points_z</span><span class="p">,</span> <span class="o">*</span><span class="n">points_x</span><span class="p">,</span> <span class="o">*</span><span class="n">points_y</span><span class="p">])</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">x0</span> <span class="o">+</span> <span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">pos</span><span class="o">.</span><span class="n">width</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">pos</span><span class="o">.</span><span class="n">height</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="o">*</span><span class="n">pos</span><span class="o">.</span><span class="n">width</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">])</span>

    <span class="n">tr1</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="o">*</span><span class="n">pts</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="c1"># Have same color for traingles sharing hypotenuse to see box</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tr1</span><span class="o">.</span><span class="n">triangles</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="c1"># a,b,c are the 3 points of the triangle</span>
        <span class="n">mid_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># Right angle at c</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Right angle at a</span>
            <span class="n">mid_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Right angle at b</span>
            <span class="n">mid_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mid_point</span><span class="p">)</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

    <span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">_C</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">])[:,:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">r</span><span class="o">*</span><span class="n">A</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">B</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">_C</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">r</span><span class="o">+</span><span class="n">g</span><span class="o">+</span><span class="n">b</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">])</span>
    <span class="n">_max</span> <span class="o">=</span> <span class="n">_colors</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Should be normalized after matching to colobar as well</span>
    <span class="n">_max</span><span class="p">[</span><span class="n">_max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_colors</span> <span class="o">=</span> <span class="n">_colors</span><span class="o">/</span><span class="n">_max</span>

    <span class="n">col</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">([</span><span class="n">pts</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tr1</span><span class="o">.</span><span class="n">triangles</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">_colors</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;face&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>


    <span class="n">cax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">rotation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">210</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="n">cax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">  &#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cax</span></div>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">splot_rgb_lines</span><span class="p">(</span>
    <span class="n">path_evr</span>    <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">elements</span>    <span class="o">=</span> <span class="p">[[],[],[]],</span>
    <span class="n">orbs</span>        <span class="o">=</span> <span class="p">[[],[],[]],</span>
    <span class="n">labels</span>      <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
    <span class="n">ax</span>          <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">skipk</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">elim</span>        <span class="o">=</span> <span class="p">[],</span>
    <span class="n">max_width</span>   <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ktick_inds</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">ktick_vals</span>  <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\Gamma$&#39;</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">],</span>
    <span class="n">kseg_inds</span>   <span class="o">=</span> <span class="p">[],</span>
    <span class="n">Fermi</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">txt</span>         <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xytxt</span>       <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.9</span><span class="p">],</span>
    <span class="n">ctxt</span>        <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">spin</span>        <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
    <span class="n">interp_nk</span>   <span class="o">=</span> <span class="p">{},</span>
    <span class="n">scale_data</span>  <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">colorbar</span>    <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">colormap</span>    <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">N</span>           <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
    <span class="n">shadow</span>      <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">query_data</span>  <span class="o">=</span> <span class="p">{}</span>
    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns axes object and plot on which all matplotlib allowed actions could be performed. In this function,orbs,labels,elements all have list of length 3. Inside list, sublists or strings could be any length but should be there even if empty.</span>
<span class="sd">    Args:</span>
<span class="sd">        - path_evr   : path/to/vasprun.xml or output of `export_vasprun`. Auto picks in CWD.</span>
<span class="sd">        - elements   : List [[],[],[]] by default and plots s,p,d orbital of system.</span>
<span class="sd">        - orbs       : List [[r],[g],[b]] of indices of orbitals, could be empty, but shape should be same.</span>
<span class="sd">        - labels     : List [str,str,str] of projection labels. empty string should exist to maintain shape. Auto adds ``,`` for ISPIN=2. If a label is empty i.e. &#39;&#39;, it will not show up in colorbar ticks or legend.</span>
<span class="sd">        - ax         : Matplotlib axes object, if not given, one is created.</span>
<span class="sd">        - skipk      : Number of kpoints to skip, default will be from IBZKPT.</span>
<span class="sd">        - kseg_inds  : Points where kpath is broken.</span>
<span class="sd">        - elim       : [min,max] of energy range.</span>
<span class="sd">        - Fermi    : If not given, automatically picked from `export_vasprun`.</span>
<span class="sd">        - ktick_inds : High symmetry kpoints indices.abs</span>
<span class="sd">        - ktick_vals : High Symmetry kpoints labels.</span>
<span class="sd">        - max_width  : Default is None and linewidth at any point = 2.5*sum(ions+orbitals projection of all three input at that point). Linewidth is scaled to max_width if an int or float is given.</span>
<span class="sd">        - txt        : Text on figure, if None, SYSTEM&#39;s name is printed.</span>
<span class="sd">        - xytxt      : [x_coord,y_coord] of text relative to axes.</span>
<span class="sd">        - ctxt       : color of text.</span>
<span class="sd">        - spin       : Plot spin-polarized for spin {&#39;up&#39;,&#39;down&#39;,&#39;both&#39;}. Default is both.</span>
<span class="sd">        - interp_nk  : Dictionary with keys &#39;n&#39; and &#39;k&#39; for interpolation.</span>
<span class="sd">        - scale_data : Default is False. If True, normalizes projection data to 1.</span>
<span class="sd">        - colorbar   : Default is True. Displays a vertical RGB colorbar. Forfine control, set it False and use `plot_handle.add_colorbar` and `plot_handle.color_cube` just afer plotting.</span>
<span class="sd">        - colormap   : 1.2.7+, Default is None and picks suitable for each case. For all three projections given, only first, middle and last colors are used to interpolate between them.</span>
<span class="sd">        - N          : Number of distinct colors in colormap. For given three non-zero projections, even number will be rounded up to greater odd number, so 4 and 5 are same in that case.</span>
<span class="sd">        - query_data : Dictionary with keys as label and values as list of length 2. Should be &lt;= 3 for RGB plots. If given, used in place of elements, orbs and labels arguments.</span>
<span class="sd">                        Example: {&#39;s&#39;:([0,1],[0]),&#39;p&#39;:([0,1],[1,2,3]),&#39;d&#39;:([0,1],[4,5,6,7,8])} will pick up s,p,d orbitals of first two ions of system.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - ax : matplotlib axes object with plotted projected bands.</span>

<span class="sd">    &gt; Note: Two figures made by this function could be comapred quantitatively only if `scale_data=False, max_width=None` as these parameters act internally on data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Fix input data</span>
    <span class="n">vr</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">_validate_evr</span><span class="p">(</span><span class="n">path_evr</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span><span class="n">skipk</span><span class="o">=</span><span class="n">skipk</span><span class="p">,</span><span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">)</span>

    <span class="c1"># Fix orbitals, elements and labels lengths very early.</span>
    <span class="k">if</span> <span class="n">query_data</span><span class="p">:</span>
        <span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="n">_format_input</span><span class="p">(</span><span class="n">query_data</span><span class="p">,</span><span class="n">rgb</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Preferred over elements,orbs,labels</span>

    <span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="n">_validate_input</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="p">,</span><span class="n">rgb</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Main working here.</span>
    <span class="k">if</span> <span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can not plot an empty eigenvalues object.</span><span class="se">\n</span><span class="s2">&quot;</span>
                         <span class="s2">&quot;Try with large energy range.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spin can take any of [&#39;up&#39;,&#39;down&#39;. &#39;both&#39;] only.&quot;</span><span class="p">)</span>

    <span class="c1"># Small things</span>
    <span class="k">if</span> <span class="n">Fermi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Fermi</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">fermi</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">join_ksegments</span><span class="p">(</span><span class="n">vr</span><span class="o">.</span><span class="n">kpath</span><span class="p">,</span><span class="n">kseg_inds</span> <span class="o">=</span> <span class="n">kseg_inds</span><span class="p">)</span>
    <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ktick_inds</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">K</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">K</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">elim</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">elim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">elim</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Make axes if not given.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">ax</span><span class="p">]):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">get_axes</span><span class="p">()</span>



    <span class="n">non_zero_inds</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_zero_inds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">N</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># N should be odd because even numbers mess up color mapping in 3.</span>
    <span class="c1">#=====================================================</span>
    <span class="k">def</span> <span class="nf">_add_collection</span><span class="p">(</span><span class="n">gpd_args</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">ax</span><span class="p">):</span>
        <span class="n">pros_data</span> <span class="o">=</span> <span class="n">_get_pros_data</span><span class="p">(</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>
        <span class="n">_lws_</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pros_data</span><span class="p">[</span><span class="s1">&#39;pros&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Before changing color, get linewidths</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">_min_max_c</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_lws_</span><span class="p">)</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_lws_</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">]</span> <span class="c1"># Save for later use.</span>
        <span class="n">pros_data</span><span class="p">[</span><span class="s1">&#39;lws&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">_lws_</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">_lws_</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># NBANDS[NKPTS-1] repeatition.</span>
        <span class="c1"># These &#39;lws&#39; are passed in to _make_line_collection to keep true linwidths even color changes</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="n">pros_data</span><span class="p">[</span><span class="s1">&#39;pros&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_zero_inds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">percent_colors</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:,:,</span><span class="n">non_zero_inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">percent_colors</span> <span class="o">=</span> <span class="n">percent_colors</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">percent_colors</span><span class="p">)</span>
            <span class="n">pros_data</span><span class="p">[</span><span class="s1">&#39;pros&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span> <span class="ow">or</span> <span class="s1">&#39;copper&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">)(</span><span class="n">percent_colors</span><span class="p">)[:,:,:</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># Get colors in RGB space.</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_zero_inds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">d2_colors</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:,:,</span><span class="n">non_zero_inds</span><span class="p">]</span>
            <span class="n">_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">d2_colors</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">_sum</span><span class="p">[</span><span class="n">_sum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">percent_colors</span> <span class="o">=</span> <span class="n">d2_colors</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">_sum</span> <span class="c1"># second one is on top</span>
            <span class="n">pros_data</span><span class="p">[</span><span class="s1">&#39;pros&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span> <span class="ow">or</span> <span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">)(</span><span class="n">percent_colors</span><span class="p">)[:,:,:</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># Get colors in RGB space.</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Normalize color at each point only for 3 projections.</span>
            <span class="n">c_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">c_max</span><span class="p">[</span><span class="n">c_max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#Avoid division error:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="o">/</span><span class="n">c_max</span> <span class="c1"># Weights to be used for color interpolation.</span>

            <span class="n">nsegs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">endpoint</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">low</span><span class="p">,</span><span class="n">high</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nsegs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">nsegs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="n">colors</span><span class="p">[(</span><span class="n">colors</span> <span class="o">&gt;=</span> <span class="n">low</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">colors</span> <span class="o">&lt;</span> <span class="n">high</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># Center of squre is taken in color_cube</span>

            <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span> <span class="ow">or</span> <span class="s1">&#39;brg&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">)([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">])[:,:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">pros_data</span><span class="p">[</span><span class="s1">&#39;pros&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[(</span><span class="n">r</span><span class="o">*</span><span class="n">A</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">B</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">r</span> <span class="o">+</span> <span class="n">g</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">_cols</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">_cols</span> <span class="ow">in</span> <span class="n">colors</span>
            <span class="p">])</span>

            <span class="c1"># Normalize after picking colors from colormap as well to match the color_cube.</span>
            <span class="n">c_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pros_data</span><span class="p">[</span><span class="s1">&#39;pros&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">c_max</span><span class="p">[</span><span class="n">c_max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#Avoid division error:</span>

            <span class="n">pros_data</span><span class="p">[</span><span class="s1">&#39;pros&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pros_data</span><span class="p">[</span><span class="s1">&#39;pros&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">c_max</span>

        <span class="n">line_coll</span><span class="p">,</span> <span class="o">=</span> <span class="n">_make_line_collection</span><span class="p">(</span><span class="o">**</span><span class="n">pros_data</span><span class="p">,</span><span class="o">**</span><span class="n">mlc_args</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">line_coll</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span>
    <span class="c1">#====================================================</span>

    <span class="c1"># After All Fixing</span>
    <span class="n">ISPIN</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ISPIN</span>
    <span class="c1"># Arguments for _get_pros_data and _make_line_collection</span>
    <span class="n">gpd_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="o">=</span><span class="n">orbs</span><span class="p">,</span><span class="n">interp_nk</span><span class="o">=</span><span class="n">interp_nk</span><span class="p">,</span><span class="n">scale_data</span><span class="o">=</span><span class="n">scale_data</span><span class="p">)</span>
    <span class="n">mlc_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rgb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">colors_list</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">,</span> <span class="n">shadow</span> <span class="o">=</span> <span class="n">shadow</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ISPIN</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">gpd_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">-</span><span class="n">Fermi</span><span class="p">,</span> <span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="p">))</span>
        <span class="n">_add_collection</span><span class="p">(</span><span class="n">gpd_args</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ISPIN</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">gpd_args1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinUp</span><span class="o">-</span><span class="n">Fermi</span><span class="p">,</span>
                        <span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinUp</span><span class="p">,</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>
        <span class="n">gpd_args2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinDown</span><span class="o">-</span><span class="n">Fermi</span><span class="p">,</span>
                        <span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinDown</span><span class="p">,</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">]:</span>
            <span class="n">_add_collection</span><span class="p">(</span><span class="n">gpd_args1</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">]:</span>
            <span class="n">_add_collection</span><span class="p">(</span><span class="n">gpd_args2</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="c1"># Aethetcis of plot.</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">txt</span> <span class="k">if</span> <span class="n">txt</span> <span class="k">else</span> <span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">SYSTEM</span>
    <span class="n">add_text</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">xs</span><span class="o">=</span><span class="n">xytxt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ys</span><span class="o">=</span><span class="n">xytxt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">txts</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">ctxt</span><span class="p">)</span>
    <span class="n">modify_axes</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span><span class="n">xt_labels</span><span class="o">=</span><span class="n">ktick_vals</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">vlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">_tls_</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span> <span class="c1"># To avoid side effects, new labels array.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">and</span> <span class="n">ISPIN</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">_tls_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^$&#39;</span> <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;up&#39;</span> <span class="k">else</span> <span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^$&#39;</span> <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;down&#39;</span> <span class="k">else</span> <span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^{}$&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_zero_inds</span><span class="p">)</span> <span class="o">==</span>  <span class="mi">1</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">_min_max_c</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">4.2f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">]</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">colormap</span> <span class="ow">or</span> <span class="s1">&#39;copper&#39;</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_zero_inds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="n">_tls_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">non_zero_inds</span><span class="p">]</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">colormap</span> <span class="ow">or</span> <span class="s1">&#39;coolwarm&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ticklabels</span> <span class="o">=</span> <span class="n">_tls_</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">colormap</span> <span class="ow">or</span> <span class="s1">&#39;brg&#39;</span>

    <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_zero_inds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">add_colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ticklabels</span> <span class="o">=</span> <span class="n">ticklabels</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">,</span><span class="n">cmap_or_clist</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_zero_inds</span><span class="p">)</span> <span class="o">==</span>  <span class="mi">1</span><span class="p">:</span>
                <span class="n">cax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">_tls_</span><span class="p">[</span><span class="n">non_zero_inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color_cube</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">colormap</span> <span class="o">=</span> <span class="n">colormap</span> <span class="ow">or</span> <span class="s1">&#39;brg&#39;</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">_tls_</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># MAKE PARTIAL COLOR CUBE AND COLORBAR HERE FOR LATER USE.</span>
        <span class="k">def</span> <span class="nf">recent_colorbar</span><span class="p">(</span><span class="n">cax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tickloc</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">vertical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">add_colorbar</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">cmap_or_clist</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span>
                    <span class="n">ticks</span> <span class="o">=</span> <span class="n">ticks</span><span class="p">,</span> <span class="n">ticklabels</span> <span class="o">=</span> <span class="n">ticklabels</span><span class="p">,</span> <span class="n">tickloc</span> <span class="o">=</span> <span class="n">tickloc</span><span class="p">,</span>
                    <span class="n">vertical</span><span class="o">=</span><span class="n">vertical</span><span class="p">,</span><span class="n">digits</span><span class="o">=</span><span class="n">digits</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">add_colorbar</span> <span class="o">=</span> <span class="n">recent_colorbar</span>

        <span class="k">def</span> <span class="nf">recent_color_cube</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.67</span><span class="p">,</span><span class="mf">0.67</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.3</span> <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">color_cube</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span><span class="n">colormap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ticklabels</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span>
                    <span class="n">loc</span> <span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">color_cube</span> <span class="o">=</span> <span class="n">recent_color_cube</span>

    <span class="k">return</span> <span class="n">ax</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">splot_color_lines</span><span class="p">(</span>
    <span class="n">path_evr</span>      <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">elements</span>      <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">orbs</span>          <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">labels</span>        <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span>
    <span class="n">axes</span>          <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">skipk</span>         <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kseg_inds</span>     <span class="o">=</span> <span class="p">[],</span>
    <span class="n">elim</span>          <span class="o">=</span> <span class="p">[],</span>
    <span class="n">colormap</span>      <span class="o">=</span> <span class="s1">&#39;gist_rainbow&#39;</span><span class="p">,</span>
    <span class="n">shadow</span>        <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">scale_data</span>    <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">max_width</span>     <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">spin</span>          <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
    <span class="n">ktick_inds</span>    <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">ktick_vals</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">Gamma$&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">],</span>
    <span class="n">Fermi</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">showlegend</span>    <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">xytxt</span>         <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">],</span>
    <span class="n">ctxt</span>          <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">interp_nk</span>     <span class="o">=</span> <span class="p">{},</span>
    <span class="n">legend_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ncol&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;anchor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">),</span>
                   <span class="s1">&#39;handletextpad&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;handlelength&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="n">query_data</span>    <span class="o">=</span> <span class="p">{},</span>
     <span class="o">**</span><span class="n">subplots_adjust_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns axes object and plot on which all matplotlib allowed actions could be performed. If given, elements, orbs, and labels must have same length. If not given, zeroth ion is plotted with s-orbital.</span>
<span class="sd">    Args:</span>
<span class="sd">        - path_evr   : Path/to/vasprun.xml or output of `export_vasprun`. Auto picks in CWD.</span>
<span class="sd">        - elements   : List [[0],], by defualt and plot first ion&#39;s projections.</span>
<span class="sd">        - orbs       : List [[0],] lists of indices of orbitals, could be empty.</span>
<span class="sd">        - labels     : List [str,] of orbitals labels. len(labels)==len(orbs) must hold.  Auto adds ``,`` for ISPIN=2. If a label is empty i.e. &#39;&#39;, it will not show up in legend.</span>
<span class="sd">        - axes       : Matplotlib axes object with one or many axes, if not given, auto created.</span>
<span class="sd">        - skipk      : Number of kpoints to skip, default will be from IBZKPT.</span>
<span class="sd">        - kseg_inds : Points where kpath is broken.</span>
<span class="sd">        - elim       : [min,max] of energy range.</span>
<span class="sd">        - Fermi    : If not given, automatically picked from `export_vasprun`.</span>
<span class="sd">        - ktick_inds : High symmetry kpoints indices.abs</span>
<span class="sd">        - ktick_vals  : High Symmetry kpoints labels.</span>
<span class="sd">        - colormap  : Matplotlib&#39;s standard color maps. Default is &#39;gist_ranibow&#39;.</span>
<span class="sd">        - showlegend : True by defualt and displays legend relative to axes[0]. If False, it writes text on individual ax.</span>
<span class="sd">        - scale_data : Default is False, If True, normalize projection data to 1.</span>
<span class="sd">        - max_width  : Width to scale whole projections. Default is None and linewidth at any point on a line = 2.5*sum(ions+orbitals projection of the input for that line at that point). Linewidth is scaled to max_width if an int or float is given.</span>
<span class="sd">        - xytxt      : [x_coord,y_coord] of labels relative to axes. Works if showlegend = False.</span>
<span class="sd">        - ctxt       : color of text of labels</span>
<span class="sd">        - spin       : Plot spin-polarized for spin {&#39;up&#39;,&#39;down&#39;,&#39;both&#39;}. Default is both.</span>
<span class="sd">        - interp_nk   : Dictionary with keys &#39;n&#39; and &#39;k&#39; for interpolation.</span>
<span class="sd">        - legend_kwargs: Dictionary containing legend arguments.</span>
<span class="sd">        - query_data : Dictionary with keys as label and values as list of length 2. If given, used in place of elements, orbs and labels arguments.</span>
<span class="sd">                        Example: {&#39;s&#39;:([0,1],[0]),&#39;p&#39;:([0,1],[1,2,3]),&#39;d&#39;:([0,1],[4,5,6,7,8])} will pick up s,p,d orbitals of first two ions of system.</span>
<span class="sd">        - **subplots_adjust_kwargs : plt.subplots_adjust parameters.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - axes : matplotlib axes object [one or list of axes] with plotted projected bands.</span>
<span class="sd">    &gt; Note: Two figures made by this function could be comapred quantitatively only if `scale_data=False, max_width=None` as these parameters act internally on data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Fix data input</span>
    <span class="n">vr</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">_validate_evr</span><span class="p">(</span><span class="n">path_evr</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span><span class="n">skipk</span><span class="o">=</span><span class="n">skipk</span><span class="p">,</span><span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">)</span>
    <span class="c1"># Fix orbitals, elements and labels lengths very early.</span>
    <span class="k">if</span> <span class="n">query_data</span><span class="p">:</span>
        <span class="n">elements</span><span class="p">,</span> <span class="n">orbs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">_format_input</span><span class="p">(</span><span class="n">query_data</span><span class="o">=</span><span class="n">query_data</span><span class="p">,</span><span class="n">rgb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="c1"># preferred over elements, orbs, labels</span>

    <span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="n">_validate_input</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="p">)</span>

    <span class="c1"># Main working here.</span>
    <span class="k">if</span> <span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can not plot an empty eigenvalues object.</span><span class="se">\n</span><span class="s2">&quot;</span>
                         <span class="s2">&quot;Try with large energy range.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spin can take any of [&#39;up&#39;,&#39;down&#39;. &#39;both&#39;] only.&quot;</span><span class="p">)</span>


    <span class="c1"># Small things</span>
    <span class="k">if</span> <span class="n">Fermi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Fermi</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">fermi</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">join_ksegments</span><span class="p">(</span><span class="n">vr</span><span class="o">.</span><span class="n">kpath</span><span class="p">,</span><span class="n">kseg_inds</span><span class="o">=</span><span class="n">kseg_inds</span><span class="p">)</span>
    <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ktick_inds</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">K</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">K</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">elim</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">elim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">elim</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Fix elements and colors length. ISPIN 2 case is done in loop itself</span>
    <span class="k">if</span> <span class="n">colormap</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="p">():</span>
        <span class="n">c_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;colormap = </span><span class="si">{!r}</span><span class="s2"> not exists, falling back to default color map.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colormap</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>
    <span class="n">c_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">orbs</span><span class="p">))</span>
    <span class="n">colors</span>  <span class="o">=</span> <span class="n">c_map</span><span class="p">(</span><span class="n">c_vals</span><span class="p">)</span>

    <span class="c1"># After All Fixing</span>
    <span class="n">ISPIN</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ISPIN</span>
    <span class="c1"># Arguments for _get_pros_data and _make_line_collection</span>
    <span class="n">gpd_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="o">=</span><span class="n">orbs</span><span class="p">,</span><span class="n">interp_nk</span><span class="o">=</span><span class="n">interp_nk</span><span class="p">,</span><span class="n">scale_data</span><span class="o">=</span><span class="n">scale_data</span><span class="p">)</span>
    <span class="n">mlc_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rgb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">colors_list</span><span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">,</span> <span class="n">shadow</span> <span class="o">=</span> <span class="n">shadow</span><span class="p">)</span>

    <span class="c1">#============================================================</span>
    <span class="k">def</span> <span class="nf">_plot_collection</span><span class="p">(</span><span class="n">gpd_args</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">axes</span><span class="p">]):</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">get_axes</span><span class="p">()</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axes</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># Safe list any axes size</span>
        <span class="n">pros_data</span>  <span class="o">=</span> <span class="n">_get_pros_data</span><span class="p">(</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>
        <span class="n">line_coll</span>  <span class="o">=</span> <span class="n">_make_line_collection</span><span class="p">(</span><span class="o">**</span><span class="n">pros_data</span><span class="p">,</span><span class="o">**</span><span class="n">mlc_args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_coll</span><span class="p">):</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">l_c</span> <span class="ow">in</span> <span class="n">line_coll</span><span class="p">]</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">lc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">line_coll</span><span class="p">)]</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">axes</span>
    <span class="c1">#============================================================</span>

    <span class="k">if</span> <span class="n">ISPIN</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">gpd_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">-</span><span class="n">Fermi</span><span class="p">,</span><span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="p">))</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">_plot_collection</span><span class="p">(</span><span class="n">gpd_args</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ISPIN</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">gpd_args1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinUp</span><span class="o">-</span><span class="n">Fermi</span><span class="p">,</span>
                        <span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinUp</span><span class="p">,</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>
        <span class="n">gpd_args2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinDown</span><span class="o">-</span><span class="n">Fermi</span><span class="p">,</span>
                        <span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinDown</span><span class="p">,</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">]:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">_plot_collection</span><span class="p">(</span><span class="n">gpd_args1</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">]:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">_plot_collection</span><span class="p">(</span><span class="n">gpd_args2</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>

    <span class="c1"># Aesthetics</span>
    <span class="n">_tls_</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span> <span class="c1"># To avoid side effects, new labels array.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">and</span> <span class="n">ISPIN</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">_tls_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^$&#39;</span> <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;up&#39;</span> <span class="k">else</span> <span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^$&#39;</span> <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;down&#39;</span> <span class="k">else</span> <span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^{}$&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">showlegend</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_width</span><span class="o">/</span><span class="mi">2</span> <span class="k">if</span> <span class="n">max_width</span> <span class="k">else</span> <span class="mf">2.5</span><span class="p">)</span>
        <span class="n">add_legend</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">_tls_</span><span class="p">,</span><span class="n">widths</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="n">xytxt</span><span class="p">]</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_text</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">xs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">ys</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">txts</span><span class="o">=</span><span class="n">_tl_</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">ctxt</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">_tl_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">_tls_</span><span class="p">)]</span>
    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span><span class="n">xt_labels</span><span class="o">=</span><span class="n">ktick_vals</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">vlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="o">**</span><span class="n">subplots_adjust_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axes</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">_select_pdos</span><span class="p">(</span>
    <span class="n">tdos</span>        <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pdos_set</span>    <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ions</span>        <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,],</span>
    <span class="n">orbs</span>        <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,],</span>
    <span class="n">Fermi</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">interp_nk</span>   <span class="o">=</span> <span class="p">{}</span>
     <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns (interpolated/orginal) enrgy(N,), tdos(N,), and pdos(N,) of selected ions/orbitals.</span>
<span class="sd">    Args:</span>
<span class="sd">        - tdos     : `export_vasprun`().tdos or `get_tdos`().tdos. If calculations are spin-polarized, it will be `..tdos.SpinUp/SpinDown` for both. You need to apply this function twice for SpinUp and SpinDown separately.</span>
<span class="sd">        - pdos_set : `export_vasprun().pro_dos.pros` or `get_dos_pro_set`().pros. If calculations are spin-polarized, it will be `...pros.SpinUp/SpinDown` for both.</span>
<span class="sd">        - ions     : List of ions to project on, could be `range(start,stop,step)` as well, remember that `stop` is not included in python. so `range(0,2)` will generate 0 and 1 indices.</span>
<span class="sd">        - orbs     : List of orbitals indices to pick.</span>
<span class="sd">        - Fermi  : Here it is zero. Needs to be input.</span>
<span class="sd">        - interp_nk   : Dictionary with keys &#39;n&#39; and &#39;k&#39; for interpolation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tdos</span><span class="o">==</span><span class="p">[]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can not plot empty DOS.&quot;</span><span class="p">)</span>
    <span class="n">en</span> <span class="o">=</span> <span class="n">tdos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Fermi</span>
    <span class="n">t_dos</span> <span class="o">=</span> <span class="n">tdos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">pdos_set</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">:],</span><span class="nb">list</span><span class="p">(</span><span class="n">ions</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">p_dos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">pros</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interp_nk</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">ipyvasp</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">gu</span>
        <span class="n">_en</span><span class="p">,</span><span class="n">_tdos</span><span class="o">=</span><span class="n">gu</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">t_dos</span><span class="p">,</span><span class="o">**</span><span class="n">interp_nk</span><span class="p">)</span>
        <span class="n">_tdos</span> <span class="o">=</span> <span class="n">_tdos</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">_pdos</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">p_dos</span><span class="p">,</span><span class="o">**</span><span class="n">interp_nk</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_en</span><span class="p">,</span><span class="n">_tdos</span><span class="p">,</span><span class="n">_pdos</span><span class="o">=</span><span class="n">pdos_set</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Fermi</span><span class="p">,</span><span class="n">t_dos</span><span class="p">,</span><span class="n">p_dos</span> <span class="c1"># reading _en from projected dos if not interpolated.</span>

    <span class="k">return</span> <span class="n">_en</span><span class="p">,</span><span class="n">_tdos</span><span class="p">,</span><span class="n">_pdos</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">_collect_dos</span><span class="p">(</span>
    <span class="n">path_evr</span>      <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">elim</span>          <span class="o">=</span> <span class="p">[],</span>
    <span class="n">elements</span>      <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
    <span class="n">orbs</span>          <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
    <span class="n">labels</span>        <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,],</span>
    <span class="n">Fermi</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">spin</span>          <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
    <span class="n">interp_nk</span>     <span class="o">=</span> <span class="p">{}</span>
    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns lists of energy,tdos, pdos and labels. If given,elements,orbs and labels must have same length. If not given, zeroth ions is collected with s-orbital.</span>
<span class="sd">    Args:)</span>
<span class="sd">        - path_evr   : Path/to/vasprun.xml or output of `export_vasprun`. Auto picks in CWD.</span>
<span class="sd">        - elim       : [min,max] of energy range.</span>
<span class="sd">        - Fermi    : If not given, automatically picked from `export_vasprun`.</span>
<span class="sd">        - elements   : List [[0],], by defualt and plot first ion&#39;s projections.</span>
<span class="sd">        - orbs       : List [[0],] lists of indices of orbitals, could be empty.</span>
<span class="sd">        - labels     : List [str,] of orbitals labels. len(labels)==len(orbs) must hold.  Auto adds ``,`` for ISPIN=2.</span>
<span class="sd">        - spin       : Plot spin-polarized for spin {&#39;up&#39;,&#39;down&#39;,&#39;both&#39;}. Default is both.</span>
<span class="sd">        - interp_nk   : Dictionary with keys &#39;n&#39; and &#39;k&#39; for interpolation.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - Energy : (N,1) size.</span>
<span class="sd">        - tdos   : (N,1) size or [(N,1),(N,1)] if spin polarized.</span>
<span class="sd">        - pdos   : [(N,1),(N,1),...], spin polarized is auto-fixed.</span>
<span class="sd">        - labels : [&#39;label1,&#39;label2&#39;,...] spin polarized is auto-fixed.</span>
<span class="sd">        - vr     : Exported vasprun.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vr</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">_validate_evr</span><span class="p">(</span><span class="n">path_evr</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span><span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">)</span>

    <span class="c1"># Fix orbitals, elements and labels lengths very early.</span>
    <span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="n">_validate_input</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="p">)</span>

    <span class="c1"># Main working here.</span>
    <span class="k">if</span> <span class="n">vr</span><span class="o">.</span><span class="n">pro_dos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can not plot an empty DOS object.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;spin can take `up`,`down` or `both` values only.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span><span class="p">(</span><span class="n">Fermi</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">Fermi</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">Fermi</span>
    <span class="n">nfields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_dos</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1">#</span>


    <span class="c1"># After All Fixing</span>
    <span class="n">ISPIN</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ISPIN</span>
    <span class="n">e</span><span class="p">,</span><span class="n">ts</span><span class="p">,</span><span class="n">ps</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,[],[]</span> <span class="c1"># to collect all total/projected dos.</span>
    <span class="k">for</span> <span class="n">elem</span><span class="p">,</span><span class="n">orb</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
        <span class="n">args_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ions</span><span class="o">=</span><span class="n">elem</span><span class="p">,</span><span class="n">orbs</span><span class="o">=</span><span class="n">orb</span><span class="p">,</span><span class="n">interp_nk</span><span class="o">=</span><span class="n">interp_nk</span><span class="p">,</span><span class="n">Fermi</span><span class="o">=</span><span class="n">Fermi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ISPIN</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">tdos</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">tdos</span>
            <span class="n">pdos_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_dos</span><span class="o">.</span><span class="n">pros</span>
            <span class="n">e</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">_select_pdos</span><span class="p">(</span><span class="n">tdos</span><span class="o">=</span><span class="n">tdos</span><span class="p">,</span><span class="n">pdos_set</span><span class="o">=</span><span class="n">pdos_set</span><span class="p">,</span> <span class="o">**</span><span class="n">args_dict</span><span class="p">)</span>
            <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">if</span> <span class="n">ISPIN</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">tdos1</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">SpinUp</span>
            <span class="n">tdos2</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">SpinDown</span>
            <span class="n">pdos_set1</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_dos</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinUp</span>
            <span class="n">pdos_set2</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_dos</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinDown</span>
            <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;up&#39;</span><span class="p">:</span>
                <span class="n">e</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">p1</span> <span class="o">=</span> <span class="n">_select_pdos</span><span class="p">(</span><span class="n">tdos</span><span class="o">=</span><span class="n">tdos1</span><span class="p">,</span><span class="n">pdos_set</span><span class="o">=</span><span class="n">pdos_set1</span><span class="p">,</span> <span class="o">**</span><span class="n">args_dict</span><span class="p">)</span>
                <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^$&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">t1</span>
            <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;down&#39;</span><span class="p">:</span>
                <span class="n">e</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">p2</span> <span class="o">=</span> <span class="n">_select_pdos</span><span class="p">(</span><span class="n">tdos</span><span class="o">=</span><span class="n">tdos2</span><span class="p">,</span><span class="n">pdos_set</span><span class="o">=</span><span class="n">pdos_set2</span><span class="p">,</span> <span class="o">**</span><span class="n">args_dict</span><span class="p">)</span>
                <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
                <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^$&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">t2</span>
            <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;both&#39;</span><span class="p">:</span>
                <span class="n">e</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">p1</span> <span class="o">=</span> <span class="n">_select_pdos</span><span class="p">(</span><span class="n">tdos</span><span class="o">=</span><span class="n">tdos1</span><span class="p">,</span><span class="n">pdos_set</span><span class="o">=</span><span class="n">pdos_set1</span><span class="p">,</span> <span class="o">**</span><span class="n">args_dict</span><span class="p">)</span>
                <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^$&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">e</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">p2</span> <span class="o">=</span> <span class="n">_select_pdos</span><span class="p">(</span><span class="n">tdos</span><span class="o">=</span><span class="n">tdos2</span><span class="p">,</span><span class="n">pdos_set</span><span class="o">=</span><span class="n">pdos_set2</span><span class="p">,</span> <span class="o">**</span><span class="n">args_dict</span><span class="p">)</span>
                <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">p2</span><span class="p">)</span>
                <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^$&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">ts</span><span class="o">=</span><span class="p">[</span><span class="n">t1</span><span class="p">,</span><span class="o">-</span><span class="n">t2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">e</span><span class="p">,</span><span class="n">ts</span><span class="p">,</span><span class="n">ps</span><span class="p">,</span><span class="n">ls</span><span class="p">,</span><span class="n">vr</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">splot_dos_lines</span><span class="p">(</span>
    <span class="n">path_evr</span>      <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">elements</span>      <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
    <span class="n">orbs</span>          <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
    <span class="n">labels</span>        <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,],</span>
    <span class="n">ax</span>            <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">elim</span>          <span class="o">=</span> <span class="p">[],</span>
    <span class="n">include_dos</span>   <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
    <span class="n">colormap</span>      <span class="o">=</span> <span class="s1">&#39;gist_rainbow&#39;</span><span class="p">,</span>
    <span class="n">tdos_color</span>    <span class="o">=</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.8</span><span class="p">),</span>
    <span class="n">linewidth</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">fill_area</span>     <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">vertical</span>      <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">Fermi</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">spin</span>          <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
    <span class="n">interp_nk</span>     <span class="o">=</span> <span class="p">{},</span>
    <span class="n">showlegend</span>    <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ncol&#39;</span>         <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                   <span class="s1">&#39;anchor&#39;</span>         <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                   <span class="s1">&#39;handletextpad&#39;</span>  <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                   <span class="s1">&#39;handlelength&#39;</span>   <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="s1">&#39;fontsize&#39;</span>       <span class="p">:</span> <span class="s1">&#39;small&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;frameon&#39;</span>        <span class="p">:</span> <span class="kc">False</span>
                   <span class="p">},</span>
    <span class="n">query_data</span>    <span class="o">=</span> <span class="p">{}</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        - Returns ax object (if ax!=False) and plot on which all matplotlib allowed actions could be performed, returns lists of energy,tdos and pdos and labels. If given,elements,orbs colors, and labels must have same length. If not given, zeroth ions is plotted with s-orbital.</span>
<span class="sd">        Args:)</span>
<span class="sd">            - path_evr   : Path/to/vasprun.xml or output of `export_vasprun`. Auto picks in CWD.</span>
<span class="sd">            - elements   : List [[0],], by defualt and plot first ion&#39;s projections.</span>
<span class="sd">            - orbs       : List [[0],] lists of indices of orbitals, could be empty.</span>
<span class="sd">            - labels     : List [str,] of orbitals labels. len(labels)==len(orbs) must hold.  Auto adds ``,`` for ISPIN=2.</span>
<span class="sd">            - ax         : Matplotlib axes object, if None, one is created. If False, data lists are returned.</span>
<span class="sd">            - include_dos: One of {&#39;both&#39;,&#39;tdos&#39;,&#39;pdos&#39;}.</span>
<span class="sd">            - elim       : [min,max] of energy range.</span>
<span class="sd">            - Fermi    : If not given, automatically picked from `export_vasprun`.</span>
<span class="sd">            - colormap   : Matplotlib&#39;s standard color maps. Default is &#39;gist_ranibow&#39;.</span>
<span class="sd">            - fill_area  : Default is True and plots filled area for dos. If False, plots lines only.</span>
<span class="sd">            - vertical   : False, If True, plots along y-axis.</span>
<span class="sd">            - showlegend : True by defualt.</span>
<span class="sd">            - spin       : Plot spin-polarized for spin {&#39;up&#39;,&#39;down&#39;,&#39;both&#39;}. Default is both.</span>
<span class="sd">            - interp_nk   : Dictionary with keys &#39;n&#39; and &#39;k&#39; for interpolation.</span>
<span class="sd">            - legend_kwargs: Dictionary to contain legend arguments to fix.</span>
<span class="sd">            - query_data : Dictionary with keys as label and values as list of length 2. If given, used in place of elements, orbs and labels arguments.</span>
<span class="sd">                        Example: {&#39;s&#39;:([0,1],[0]),&#39;p&#39;:([0,1],[1,2,3]),&#39;d&#39;:([0,1],[4,5,6,7,8])} will pick up s,p,d orbitals of first two ions of system.</span>
<span class="sd">        - **Returns**</span>
<span class="sd">            - ax         : Matplotlib axes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">include_dos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;both&#39;</span><span class="p">,</span><span class="s1">&#39;pdos&#39;</span><span class="p">,</span><span class="s1">&#39;tdos&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`include_dos` expects one of [&#39;both&#39;,&#39;pdos&#39;,&#39;tdos&#39;], got </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">include_dos</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">query_data</span><span class="p">:</span>
            <span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">_format_input</span><span class="p">(</span><span class="n">query_data</span><span class="p">,</span><span class="n">rgb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># prefer query_data over elements,orbs,labels</span>

        <span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">,</span><span class="n">pdos</span><span class="p">,</span><span class="n">vr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span> <span class="c1"># Placeholders for defining. must be here.</span>
        <span class="n">cl_dos</span><span class="o">=</span><span class="n">_collect_dos</span><span class="p">(</span><span class="n">path_evr</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span>
                            <span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">,</span>
                            <span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span>
                            <span class="n">orbs</span><span class="o">=</span><span class="n">orbs</span><span class="p">,</span>
                            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                            <span class="n">Fermi</span><span class="o">=</span><span class="n">Fermi</span><span class="p">,</span>
                            <span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">,</span>
                            <span class="n">interp_nk</span><span class="o">=</span><span class="n">interp_nk</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">,</span><span class="n">pdos</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">vr</span><span class="o">=</span><span class="n">cl_dos</span> <span class="c1"># Labels updated</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Try with large energy range.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">c_map</span>   <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>
            <span class="n">c_vals</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">orbs</span><span class="p">))</span>
            <span class="n">colors</span>  <span class="o">=</span> <span class="n">c_map</span><span class="p">(</span><span class="n">c_vals</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c_map</span>   <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>
            <span class="n">c_vals</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">orbs</span><span class="p">))</span>
            <span class="n">colors</span>  <span class="o">=</span> <span class="n">c_map</span><span class="p">(</span><span class="n">c_vals</span><span class="p">)</span>

        <span class="c1"># Make additional colors for spin down. Inverted colors are better.</span>
        <span class="n">t_color</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">tdos_color</span><span class="p">)</span>
        <span class="n">it_color</span><span class="o">=</span><span class="n">gu</span><span class="o">.</span><span class="n">transform_color</span><span class="p">(</span><span class="n">t_color</span><span class="p">,</span><span class="n">c</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># -1 contrast inverts color</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">get_axes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">vertical</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fill_area</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">include_dos</span> <span class="o">!=</span> <span class="s1">&#39;pdos&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>   <span class="c1"># Spin polarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">it_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>   <span class="c1"># unpolarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;TDOS&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">include_dos</span> <span class="o">!=</span> <span class="s1">&#39;tdos&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pdos</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">p</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fill_area</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">include_dos</span> <span class="o">!=</span> <span class="s1">&#39;pdos&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>   <span class="c1"># Spin polarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">it_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>   <span class="c1"># unpolarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;TDOS&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">include_dos</span> <span class="o">!=</span> <span class="s1">&#39;tdos&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pdos</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)),</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">p</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">elim</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">elim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">elim</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">vertical</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fill_area</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">include_dos</span> <span class="o">!=</span> <span class="s1">&#39;pdos&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>   <span class="c1"># Spin polarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">en</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">en</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">it_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>   <span class="c1"># unpolarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdos</span><span class="p">,</span><span class="n">en</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;TDOS&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">include_dos</span> <span class="o">!=</span> <span class="s1">&#39;tdos&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pdos</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">en</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fill_area</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">include_dos</span> <span class="o">!=</span> <span class="s1">&#39;pdos&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>   <span class="c1"># Spin polarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">it_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>   <span class="c1"># unpolarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;TDOS&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">include_dos</span> <span class="o">!=</span> <span class="s1">&#39;tdos&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pdos</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)),</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">en</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">elim</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">elim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">elim</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">showlegend</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">add_legend</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[],</span><span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span><span class="n">widths</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="plt2html"><a class="viewcode-back" href="../../index.html#ipyvasp.plt2html">[docs]</a><span class="k">def</span> <span class="nf">plt2html</span><span class="p">(</span><span class="n">plt_fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dash_html</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns base64 encoded Image to display in notebook or HTML &lt;svg&gt; or plotly&#39;s dash_html_components.Img object.</span>
<span class="sd">    Args:</span>
<span class="sd">        - plt_fig    : Matplotlib&#39;s figure instance, auto picks as well.</span>
<span class="sd">        - transparent: True of False for fig background.</span>
<span class="sd">        - dash_html  : Default is None which results in an image display in jupyter notebook.</span>
<span class="sd">            - If True, returns html.Img object for plotly&#39;s dash.</span>
<span class="sd">            - If False, returns &lt;svg&gt; object to embed in HTML DOM.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plt_fig</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">plt_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">plot_bytes</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_bytes</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span><span class="n">transparent</span><span class="o">=</span><span class="n">transparent</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dash_html</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">if</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;ZMQInteractiveShell&#39;</span> <span class="ow">or</span> <span class="n">shell</span><span class="o">==</span><span class="s1">&#39;Shell&#39;</span><span class="p">:</span> <span class="c1">#Shell for Colab. Don&#39;t know why Google ...</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span> <span class="c1"># Clear other display</span>
                <span class="k">return</span> <span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;svg&#39;</span> <span class="o">+</span> <span class="n">plot_bytes</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;svg&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">dash_html</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span> <span class="c1"># Clear image</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;svg&#39;</span> <span class="o">+</span> <span class="n">plot_bytes</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;svg&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">base64</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span> <span class="c1"># Clear image</span>
        <span class="kn">import</span> <span class="nn">dash_html_components</span> <span class="k">as</span> <span class="nn">html</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">plot_bytes</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Img</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;data:image/svg+xml;base64,</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)))</span></div>

<span class="c1"># Cell</span>
<span class="kn">from</span> <span class="nn">plotly.io._base_renderers</span> <span class="kn">import</span> <span class="n">open_html_in_browser</span>
<div class="viewcode-block" id="show"><a class="viewcode-back" href="../../index.html#ipyvasp.show">[docs]</a><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays all available figures in browser without blocking terminal&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_fignums</span><span class="p">():</span>
        <span class="n">svg</span> <span class="o">=</span> <span class="n">plt2html</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">transparent</span> <span class="o">=</span> <span class="n">transparent</span><span class="p">,</span><span class="n">dash_html</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">html_str</span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">&lt;!DOCTYPE html&gt;</span>
<span class="s2">&lt;head&gt;&lt;/head&gt;</span>
<span class="s2">&lt;body&gt;</span>
<span class="s2">    &lt;div&gt;</span>
<span class="s2">    </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">    &lt;/div&gt;</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
        <span class="n">open_html_in_browser</span><span class="p">(</span><span class="n">html_str</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">svg</span><span class="p">,</span> <span class="n">html_str</span></div>

<div class="viewcode-block" id="savefig"><a class="viewcode-back" href="../../index.html#ipyvasp.savefig">[docs]</a><span class="k">def</span> <span class="nf">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save matplotlib&#39;s figure while handling existing files. `kwargs` are passed to `plt.savefig`&quot;&quot;&quot;</span>
    <span class="c1">#Avoids File Overwrite</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">prevent_overwrite</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="plt2text"><a class="viewcode-back" href="../../index.html#ipyvasp.plt2text">[docs]</a><span class="k">def</span> <span class="nf">plt2text</span><span class="p">(</span><span class="n">plt_fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">144</span><span class="p">,</span><span class="n">vscale</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span><span class="n">colorful</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">crop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays matplotlib figure in terminal as text. You should use a monospcae font like `Cascadia Code PL` to display image correctly. Use before plt.show().</span>
<span class="sd">    Args:</span>
<span class="sd">        - plt_fig: Matplotlib&#39;s figure instance. Auto picks if not given.</span>
<span class="sd">        - width  : Character width in terminal, default is 144. Decrease font size when width increased.</span>
<span class="sd">        - vscale : Useful to tweek aspect ratio. Default is 0.96 and prints actual aspect in `Cascadia Code PL`. It is approximately `2*width/height` when you select a single space in terminal.</span>
<span class="sd">        - colorful: Default is False, prints colored picture if terminal supports it, e.g Windows Terminal.</span>
<span class="sd">        - invert  : Defult is False, could be useful for grayscale image.</span>
<span class="sd">        - crop    : Default is False. Crops extra background, can change image color if top left pixel is not in background, in that case set this to False.</span>
<span class="sd">        - outfile: If None, prints to screen. Writes on a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plt_fig</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">plt_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">plot_bytes</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_bytes</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">plot_bytes</span><span class="p">)</span>
    <span class="c1"># crop</span>
    <span class="k">if</span> <span class="n">crop</span><span class="p">:</span>
        <span class="n">bg</span>   <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">ImageChops</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">bg</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">ImageChops</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># No idea how it works</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">getbbox</span><span class="p">()</span>
        <span class="n">img</span>  <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>

    <span class="n">w</span><span class="p">,</span> <span class="n">h</span>   <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>
    <span class="n">aspect</span> <span class="o">=</span> <span class="n">h</span><span class="o">/</span><span class="n">w</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">aspect</span> <span class="o">*</span> <span class="n">width</span> <span class="o">*</span> <span class="n">vscale</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># Integer</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">height</span> <span class="k">if</span> <span class="n">height</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">height</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1">#Make even. important</span>

    <span class="k">if</span> <span class="n">colorful</span><span class="p">:</span>
        <span class="n">img</span>  <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">getdata</span><span class="p">(),(</span><span class="n">height</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))[</span><span class="o">...</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="mi">225</span> <span class="o">-</span> <span class="n">data</span> <span class="k">if</span> <span class="n">invert</span> <span class="k">else</span> <span class="n">data</span> <span class="c1">#Inversion</span>
        <span class="n">fd</span>   <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="o">...</span><span class="p">]</span> <span class="c1">#Foreground</span>
        <span class="n">bd</span>   <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>  <span class="c1"># Background</span>
        <span class="c1"># Upper half block is forground and lower part is background, so one spot make two pixels.</span>
        <span class="n">d_str</span>  <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[48;2;</span><span class="si">{}</span><span class="s2">;</span><span class="si">{}</span><span class="s2">;</span><span class="si">{}</span><span class="s2">m</span><span class="se">\033</span><span class="s2">[38;2;</span><span class="si">{}</span><span class="s2">;</span><span class="si">{}</span><span class="s2">;</span><span class="si">{}</span><span class="s2">m</span><span class="se">\u2580\033</span><span class="s2">[00m&quot;</span> <span class="c1">#Upper half block</span>
        <span class="n">pixels</span> <span class="o">=</span> <span class="p">[[</span><span class="n">d_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">v1</span><span class="p">,</span><span class="o">*</span><span class="n">v2</span><span class="p">)</span> <span class="k">for</span> <span class="n">v1</span><span class="p">,</span><span class="n">v2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">f</span><span class="p">)]</span> <span class="k">for</span> <span class="n">b</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bd</span><span class="p">,</span><span class="n">fd</span><span class="p">)]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#</span>
        <span class="n">chars</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">,</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="s1">&#39;@&#39;</span><span class="p">]</span>
        <span class="n">chars</span>  <span class="o">=</span> <span class="n">chars</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">invert</span> <span class="k">else</span> <span class="n">chars</span> <span class="c1">#Inversion</span>
        <span class="n">img</span>    <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span> <span class="c1"># grayscale</span>
        <span class="n">pixels</span> <span class="o">=</span> <span class="p">[</span><span class="n">chars</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">img</span><span class="o">.</span><span class="n">getdata</span><span class="p">()]</span>
        <span class="n">pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pixels</span><span class="p">,(</span><span class="n">height</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="c1">#Make row/columns</span>

    <span class="n">out_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">])</span> <span class="k">for</span> <span class="n">ps</span> <span class="ow">in</span> <span class="n">pixels</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For loop is important for printing lines, otherwise breaks appear.</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">plot_potential</span><span class="p">(</span><span class="n">basis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">values</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">operation</span> <span class="o">=</span> <span class="s1">&#39;mean_c&#39;</span><span class="p">,</span>
           <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">period</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">period_right</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">interface</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">lr_pos</span><span class="o">=</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.75</span><span class="p">),</span>
           <span class="n">smoothness</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
           <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$V(z)$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\langle V \rangle _</span><span class="si">{roll}</span><span class="s1">(z)$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\langle V \rangle $&#39;</span><span class="p">),</span>
           <span class="n">colors</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.7</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">),</span>
           <span class="n">annotate</span> <span class="o">=</span> <span class="kc">True</span>
          <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns tuple(ax,Data) where Data contains resultatnt parameters of averaged potential of LOCPOT.</span>
<span class="sd">    Args:</span>
<span class="sd">        - values : `epxort_potential().values` is 3D grid data. As `epxort_potential` is slow, so compute it once and then plot the output data.</span>
<span class="sd">        - operation: Default is &#39;mean_c&#39;. What to do with provided volumetric potential data. Anyone of these &#39;mean_a&#39;,&#39;min_a&#39;,&#39;max_a&#39;,&#39;mean_b&#39;,&#39;min_b&#39;,&#39;max_b&#39;,&#39;mean_c&#39;,&#39;min_c&#39;,&#39;max_c&#39;.</span>
<span class="sd">        - ax: Matplotlib axes, if not given auto picks.</span>
<span class="sd">        - period: Periodicity of potential in fraction between 0 and 1. For example if a slab is made of 4 super cells in z-direction, period=0.25.</span>
<span class="sd">        - period_right: Periodicity of potential in fraction between 0 and 1 if right half of slab has different periodicity.</span>
<span class="sd">        - lr_pos: Locations around which averages are taken.Default (0.25,0.75). Provide in fraction between 0 and 1. Center of period is located at these given fractions. Work only if period is given.</span>
<span class="sd">        - interface: Default is 0.5 if not given, you may have slabs which have different lengths on left and right side. Provide in fraction between 0 and 1 where slab is divided in left and right halves.</span>
<span class="sd">        - smoothness: Default is 3. Large value will smooth the curve of potential. Only works if period is given.</span>
<span class="sd">        - labels: List of three labels for legend. Use plt.legend() or pp.add_legend() for labels to appear. First entry is data plot, second is its convolution and third is complete average.</span>
<span class="sd">        - colors: List of three colors for lines.</span>
<span class="sd">        - annotate: True by default, writes difference of right and left averages on plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean_a&#39;</span><span class="p">,</span><span class="s1">&#39;min_a&#39;</span><span class="p">,</span><span class="s1">&#39;max_a&#39;</span><span class="p">,</span><span class="s1">&#39;mean_b&#39;</span><span class="p">,</span><span class="s1">&#39;min_b&#39;</span><span class="p">,</span><span class="s1">&#39;max_b&#39;</span><span class="p">,</span><span class="s1">&#39;mean_c&#39;</span><span class="p">,</span><span class="s1">&#39;min_c&#39;</span><span class="p">,</span><span class="s1">&#39;max_c&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">operation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`operation` excepts any of </span><span class="si">{}</span><span class="s2">, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">check</span><span class="p">,</span><span class="n">operation</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">get_axes</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;`values` or `basis` not given, trying to autopick LOCPOT...&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ep</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">export_locpot</span><span class="p">()</span>
            <span class="n">basis</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">basis</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">values</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not auto fix. Make sure `basis` and `v` are provided.&#39;</span><span class="p">)</span>
    <span class="n">x_ind</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">operation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">other_inds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">x_ind</span><span class="p">])</span>
    <span class="n">_func_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span> <span class="k">if</span> <span class="s1">&#39;min&#39;</span> <span class="ow">in</span> <span class="n">operation</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span> <span class="k">if</span> <span class="s1">&#39;max&#39;</span> <span class="ow">in</span> <span class="n">operation</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span>
    <span class="n">pot</span> <span class="o">=</span> <span class="n">_func_</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span> <span class="n">other_inds</span><span class="p">)</span>

    <span class="c1"># Direction axis</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">basis</span><span class="p">[</span><span class="n">x_ind</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pot</span><span class="p">),</span><span class="n">endpoint</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># VASP does not include last point, it is same as firts one</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pot</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#Potential plot</span>
    <span class="n">ret_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;direction&#39;</span><span class="p">:</span><span class="n">operation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]}</span>
    <span class="c1"># Only go below if periodicity is given</span>
    <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">serializer</span><span class="o">.</span><span class="n">Dict2Data</span><span class="p">(</span><span class="n">ret_dict</span><span class="p">))</span> <span class="c1"># Simple Return</span>
    <span class="k">if</span> <span class="n">period</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arr_con</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">rolling_mean</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span><span class="n">period</span><span class="p">,</span><span class="n">period_right</span> <span class="o">=</span> <span class="n">period_right</span><span class="p">,</span><span class="n">interface</span> <span class="o">=</span> <span class="n">interface</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span> <span class="s1">&#39;wrap&#39;</span><span class="p">,</span><span class="n">smoothness</span><span class="o">=</span><span class="n">smoothness</span><span class="p">)</span>
        <span class="n">x_con</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_con</span><span class="p">),</span><span class="n">endpoint</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_con</span><span class="p">,</span><span class="n">arr_con</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># Convolved plot</span>
        <span class="c1"># Find Averages</span>
        <span class="n">left</span><span class="p">,</span><span class="n">right</span> <span class="o">=</span> <span class="n">lr_pos</span>
        <span class="n">ind_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">left</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">pot</span><span class="p">))</span>
        <span class="n">ind_2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">right</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">pot</span><span class="p">))</span>
        <span class="n">x_1</span><span class="p">,</span> <span class="n">v_1</span> <span class="o">=</span> <span class="n">x_con</span><span class="p">[</span><span class="n">ind_1</span><span class="p">],</span> <span class="n">arr_con</span><span class="p">[</span><span class="n">ind_1</span><span class="p">]</span>
        <span class="n">x_2</span><span class="p">,</span> <span class="n">v_2</span> <span class="o">=</span> <span class="n">x_con</span><span class="p">[</span><span class="n">ind_2</span><span class="p">],</span> <span class="n">arr_con</span><span class="p">[</span><span class="n">ind_2</span><span class="p">]</span>

        <span class="n">ret_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;left&#39;</span><span class="p">:{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">v_1</span><span class="p">),</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">x_1</span><span class="p">)}})</span>
        <span class="n">ret_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;right&#39;</span><span class="p">:{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">v_2</span><span class="p">),</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">x_2</span><span class="p">)}})</span>
        <span class="n">ret_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;deltav&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">v_2</span> <span class="o">-</span> <span class="n">v_1</span><span class="p">)})</span>
        <span class="c1">#Level plot</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">([</span><span class="n">x_1</span><span class="p">,</span> <span class="n">x_2</span><span class="p">],[</span><span class="n">v_1</span><span class="p">,</span> <span class="n">v_2</span><span class="p">],</span><span class="n">lw</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="c1"># Annotate</span>
        <span class="k">if</span> <span class="n">annotate</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.07</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\Delta _{R,L} = </span><span class="si">%9.6f</span><span class="s1">$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">v_2</span><span class="o">-</span><span class="n">v_1</span><span class="p">,</span><span class="mi">6</span><span class="p">)),</span><span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">ret_dict</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; (&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u212B</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;)$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">serializer</span><span class="o">.</span><span class="n">Dict2Data</span><span class="p">(</span><span class="n">ret_dict</span><span class="p">))</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Abdul Saboor
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    </body>
</html>